---
title: Power Automate Desktop フローの実行 | Microsoft Docs
description: Power Automate Desktop コンソールでフローを実行する
author: olegmelnykov
ms.service: flow
ms.topic: article
ms.date: 09/22/2020
ms.author: olmelnyk
ms.reviewer: olmelnyk
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: fa5d940666a9f31efb5d641870c77efbbcad8b47
ms.sourcegitcommit: b043b7e8c29afee4f4f25bbf0d5a662d9af9272c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "4711640"
---
# <a name="run-attended-and-unattended-desktop-flows"></a>有人および無人のデスクトップ フローの実行

デスクトップ フローを作成してテストした後は、イベント、スケジュール、またはボタンから実行できます。 これを可能にするには、デスクトップ フローを [自動化されたフロー](../get-started-logic-flow.md)、[インスタント フロー](../introduction-to-button-flows.md)、[スケジュールされたフロー](../run-scheduled-tasks.md)、または[ビジネス プロセス フロー](../business-process-flows-overview.md)に追加します。

## <a name="prerequisites"></a>前提条件

- Power Automate でデスクトップ フローがトリガーするには、デバイスに[オンプレミス データ ゲートウェイ](https://go.microsoft.com/fwlink/?LinkID=820580&clcid=0x409) が必要となります。
   
   このゲートウェイは、Power Automate とご利用のデバイス (デスクトップ フローが実行される場所) 間の、エンタープライズ レベルのセキュリティで保護された接続です。 Power Automate はゲートウェイを使用してオンプレミス デバイスにアクセスし、イベント、スケジュール、ボタンからデスクトップ フローをトリガーできるようにします。
- [デスクトップ フローの接続を設定する](setup.md)必要があります
- 職場または学校アカウント 

   >[!IMPORTANT]
   >ゲートウェイの設定、Power Automate へのサインイン、Windows デバイスへのログインには、同じ職場または学校アカウントを使用する必要があります。
   

## <a name="run-desktop-flows-unattended-or-attended"></a>有人および無人のデスクトップ フローの実行

デスクトップ フローを作成する際は、これらを **有人** モード、または **無人** モードで実行します。 無人は、人による監督が不要なアプリケーションに最適です。

無人で実行している場合、Power Automate は Windows 10、Windows Server 2016、 Windows Server 2019 を実行している対象デバイスに自動的にサインインします。 自動化が完了すると、Power Automate はデバイスからサインアウトし、そのアクティビティを報告します。

有人で実行する場合、Power Automate では既存の Windows ユーザー セッションが使用されます。

デスクトップ フローをクラウド フローに追加する際に、デスクトップ フローを有人で実行するか、または無人で実行するかを選択できます。 有人実行と無人実行の主な違いを次に示します。

### <a name="unattended-mode"></a>無人モード

無人のデスクトップ フローを実行するには、サインアウトしたすべてのユーザーがターゲット マシンを使用できるようにする必要があります。 

>[!IMPORTANT]
>ロックされている Windows ユーザー セッションがある場合は、デスクトップ フローを実行できません。

Power Automate は、以下を実行します:
1. Power Automate は、ターゲットのデバイス上で Windows ユーザー セッションを作成、管理、解放します。

1. 無人のデスクトップ フローは、画面がロックされているデバイスで実行され、実行中にフローは表示されません。

1. アクティブな Windows ユーザー セッション (ロックされている場合も含む) がある場合、Windows 10 デバイスを無人で実行することはできません。 次のエラーが表示されます: *デスクトップ フローを実行できません。ターゲットのデバイスにロックされた、または非アクティブな Windows ユーザー セッションがあります*。

1. Windows Server で、デスクトップ フローを実行するユーザーと同じユーザーでロックされた Windows ユーザーセッションを開いている場合、同じエラーが表示されます。*デスクトップ フローを実行できません。ターゲット デバイス上にロックされた、または非アクティブな Windows ユーザーセッションがあります*。

### <a name="attended-mode"></a>有人モード
有人のデスクトップ フローを実行するには、接続用に構成されたユーザーの名前と一致するアクティブな Windows ユーザー セッションが必要です。 セッションをロックすることはできません。

ターゲットのマシンで有人のデスクトップ フローが開始されると、実行が完了するまでデバイスとのやり取りを避けることをお勧めします。


## <a name="run-multiple-desktop-flows-on-the-same-device-sequentially"></a>同じデバイスで複数のデスクトップ フローを順番に実行する 

複数のデスクトップ フローをひとつ、または複数のデバイスで実行するようにスケジュールできます。 複数のデスクトップ フローが同じデバイス上で実行されるようにトリガーされている場合、Power Automate はこれらのルールに従います:

1.  最初のデスクトップ フローはターゲット デバイスで実行されます。

1.  その他のデスクトップ フローがキューに配置され、デスクトップ フローやゲートウェイの詳細ページに **待機中** と表示されます。

1.  各実行が完了した際に、次の **待機中** のデスクトップ フローを選択します。

>[!NOTE]
>これらのオーケストレーション ルールは、同じデバイス上の任意のユーザーがスケジュールするデスクトップ フローの実行に適用されます。

>[!IMPORTANT]
>実行キュー内のデスクトップ フローが多すぎる場合、タイムアウトが発生する可能性があります。 デスクトップ フローの実行は、トリガーされてから 30 分以内に実行されないと失敗します。

## <a name="run-desktop-flows-concurrently-on-windows-server-devices"></a>Windows Server デバイス上でデスクトップ フローを同時に実行する
複数のユーザーが同時に Windows Server 2016 および Windows Server 2019 にサインインできます。 Power Automate は、この OS の機能を活用して、このようなデバイス上で複数のデスクトップ フローを同時に実行することができます。 この機能により、組織はインフラストラクチャ コストを節約できます。

単一のデバイスで複数のデスクトップ フローを利用するには、次の手順を実行します:
1. オンプレミス ゲートウェイと最新バージョンのデスクトップ フローをインストールした Windows Server 2016、または 2019 のデバイスを設定します。
1. 2 つ以上のユーザー アカウントを使用して、このデバイス上のゲートウェイをターゲットとしたデスクトップ フロー接続を作成します。 

Power Automate は、同時に実行されるデスクトップ フローの数を、デバイスが対応する最大数まで自動的にスケーリングします。 デバイスの容量を超えた場合、[ここに記載](#run-multiple-desktop-flows-on-the-same-device-sequentially)されているように追加の実行が *待機* します。

>[!IMPORTANT]
>Windows Server で 3 つ以上の並列ユーザー セッションを使用する場合、リモート デスクトップ サービスをオンにする必要があります。 [RDS](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-client-access-license) の詳細をご覧ください。

>[!NOTE]
>**同一ユーザー** による複数のデスクトップ フローの同時実行には対応していません。 この機能を利用するには、さまざまなユーザーが同時にデスクトップ フローを実行する必要があります。

## <a name="load-balance-requests-across-gateways-in-a-cluster"></a>クラスター内のゲートウェイ間で要求を負荷分散する

クラスター内のゲートウェイ間で、デスクトップ フローの実行を均等に分散させることができます。 既定では、負荷分散中のゲートウェイの選択はランダムです。

[ゲートウェイを追加してクラスターを作成するには、これらの手順](https://docs.microsoft.com/data-integration/gateway/service-gateway-install#add-another-gateway-to-create-a-cluster) に従います。

>[!NOTE]
>クラスター内のオフライン ゲートウェイ メンバーは、パフォーマンスに悪影響を与えます。 これらのメンバーは無効にするか削除します。

Power Automate ゲートウェイの詳細ページから負荷分散を行うには、**データ** -> **ゲートウェイ** に移動し、ゲートウェイ クラスターを選択します。 

ゲートウェイの詳細ページで、クラスター内のすべてのゲートウェイの実行に切り替えます。 これにより、そのクラスター内のすべてのゲートウェイ上のデスクトップ フローの実行が分散されます。

   ![ゲートウェイ クラスターでデスクトップ フローの実行を分散する](../media/run-desktop-flow/gw_cluster.png "ゲートウェイ クラスター上でデスクトップ フローを配布する")
   
>[!IMPORTANT]
>ローカル Windows アカウントを使用している場合は、クラスター内のすべてのマシンが同じローカル アカウントと同じパスワードを持っている必要があります。 これらの資格情報は、デスクトップ フロー接続を作成する際に使用します。
>Active Directory または Azure AD 結合マシンを使用している場合は、デスクトップ フロー接続で使用するユーザー アカウントがクラスタ内のすべてのマシンにアクセスできることを確認してください。
   
## <a name="best-practices-to-avoid-timeouts-and-distribute-load-across-machines"></a>タイムアウトを回避し、マシン間で負荷を分散するためのベストプラクティス

複数のデスクトップ フローを実行する予定がある場合は、負荷を分散するとともに、複数のデスクトップ フローが同時に実行されているためにターゲット マシンが過負荷になったり、タイムアウトになったりすることなく、すべてのデスクトップ フローが正常に実行されるよう、一連の戦略を採用できます。 次のいずれかを実行できます:

1. デスクトップ フローを 1 日の異なる時間に実行するように計画し、経時的に負荷を分散させることができます。 これは、ワークロードを実行できるマシンが 1 台、または限られたセットであり、デスクトップ フローを開始するトリガー (たとえば、スケジュールされたフロー) を制御できる場合に最適です。
1. 同じ構成のデスクトップ フローを並行して実行できるマシンのクラスターを作成します。 
1. それぞれが異なるマシンをターゲットとする個別の接続を使用する、複数のフローを作成します。

これらの戦略に従うことで、同じデバイスでのデスクトップ フローの競合や、場合によってはタイムアウトによる失敗を回避できます。 

>[!NOTE]
>デスクトップ フローを自動モードで実行している場合は、組織が並行して実行する予定のデスクトップ フローの数を予測し、適切な量の無人アドオンを購入する必要があります。 


## <a name="rerun-failed-desktop-flows"></a>失敗したデスクトップ フローを再実行する

デスクトップ フローの実行が失敗した場合は、問題を修正してから、次の手順を行って再実行します。 

   1. 詳細ページに移動して、失敗した実行を特定します。

   1. アクション メニューで、**再送信** ボタンを選択します。

## <a name="troubleshoot-failures"></a>障害のトラブルシューティング

1. 無人のデスクトップ フローが失敗し、**新しいセッションを作成できません** というメッセージが表示された場合は、次の手順に従って問題を解決してください:

    - Windows 10 では、ターゲット デバイス上に、ロックまたはロック解除されているアクティブなユーザー セッションがないことを確認します。
    - Windows Server 2016 または Windows Server 2019 で、デバイス用に構成されているアクティブなユーザー セッションの最大数に達していないことを確認します。 デスクトップ フローは、新たなセッションを作成できない場合は実行できません。

1. **ゲートウェイの状態** が **オフライン** の場合は、デバイスの電源が入っていて、インターネットに接続されていることを確認します。 [ゲートウェイのトラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot) を行うこともできます。

1. **ゲートウェイの状態** が **オンライン** の場合は、次のアクションを試してください。

   - デバイスでデスクトップ フロー アプリやサービスが実行されていることを確認します。

   - ご利用のデバイスでサービスを再起動してください。

## <a name="learn-more"></a>詳細情報を見る

 - [オンプレミス データ ゲートウェイ](https://docs.microsoft.com/data-integration/gateway/service-gateway-app) のインストール
 - [オンプレミス データ ゲートウェイ アプリの使用](https://docs.microsoft.com/flow/gateway-manage) に関するドキュメント
 - オンプレミス データ ゲートウェイの [トラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)。

## <a name="runtime-notifications"></a>ランタイム通知

通知ポップアップは、既定では、デスクトップ フローがダウンロードや実行されている場合、キャンセルされた場合、正常に実行が終了した場合、またはエラーが発生した場合に表示されます:

![通知ウィンドウ](\media\run-pad-flow\notification-window.png)
