---
title: Windows レコーダー (V1) のフローを編集する | Microsoft Docs
description: Windows レコーダー (V1) フローの編集について説明します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: kvivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/31/2020
ms.author: DeonHe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: de81647eb8e7ae27903d2d3dde88f13d6e3cd7e8
ms.sourcegitcommit: b043b7e8c29afee4f4f25bbf0d5a662d9af9272c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "4711657"
---
# <a name="edit-windows-recorder-v1-flows"></a>Windows レコーダー (V1) のフローを編集する

Windows レコーダー (V1) のフローを活用して、Windows デスクトップ アプリケーションを自動化します。 発生する可能性のある問題、その問題の回避策、このリリースではサポートされていないシナリオの詳細については、[既知の問題](create-desktop.md#known-issues-and-solutions) を参照してください。

## <a name="prerequisites"></a>前提条件
デスクトップ Windows レコーダー (V1) のフロー。 編集するフローがない場合は、[Windows レコーダー (V1) のフローを作成してください](create-desktop.md)。

## <a name="edit-actions"></a>アクションの編集

![アクションの編集](../media/edit-desktop/edit-actions.png "アクションの編集")

レコーディングを次のように編集できます:

-   レコーディングをサポートするアクションの値を編集します。
-   ステップを削除します。
-   レコーディングを削除します。
-   ドラッグ アンド ドロップでアクションの順序を変更します。 レコーディングの整合性を壊す可能性があるため、これは慎重に行ってください。

詳細パラメーターで次を変更できます:

-  アクション実行後の遅延。 たとえば、PT0S を PT1S に変更することで 1 秒の遅延を追加できます。 この設定は、ターゲット アプリケーションの応答時間が遅く、Windows レコーダー (V1) フローの次のステップに進む前に完了しない場合に便利です。 また、明示的に[遅延アクションを追加](edit-desktop.md#add-a-delay) して、ループで使用することができます。
-   ターゲット ユーザー インターフェイス要素の [セレクター](edit-desktop.md#set-the-selector)。


## <a name="add-a-recording"></a>記録を追加する

Windows レコーダー (V1) のフローを複数回に分けて記録したい場合があります。 最初のレコーディングが完了したら、次のように進めることができます:

1. [Power Automate](https://flow.microsoft.com) にサインインする。
1. **マイ フロー** > **デスクトップ フロー** を選択します。
1. 編集する Windows レコーダー (V1) フローを選択します。

   ![編集する Windows レコーダー (V1) のフローを表示するイメージ](../media/edit-desktop/select-desktop-flow.png)

1. **編集** を選択します。 
1. **新しいステップ** を選択します。

   ![新しいステップ](../media/edit-desktop/new-step.png "新しいステップ")

1. アクションの一覧から **アプリの記録** を選択します。

   ![アプリの記録](../media/edit-desktop/select-record-ui-actions.png "アプリを記録します")

1. **レコーダーの起動** を選択します。

   ![[レコーダーの起動] の選択](../media/create-windows-desktop-flow/select-launch-recorder.png "[レコーダーの起動] の選択")

   レコーダー コントロールが画面の上部に表示されます。

   ![レコーダー コントロール](../media/create-windows-desktop-flow/recorder-control.png "レコーダー コントロール")

1. 記録するアプリを開始します。

     >[!TIP]
     >アプリのコントロールにマウスを置くと、各コントロールが青の枠線で強調表示されます。 コントロールを選択する前に、必ず青い強調表示を待ってください。
     >
     >要素の周囲に青の強調表示が表示されない場合は、適切に記録されていない可能性があります。

1. レコーダー コントロールから **記録** を選択します。

1. 記録しているアプリのユーザー インターフェイスでステップを実行し、レコーダー コントロールで **完了** を選択します。
1. **保存** を選択し、Windows レコーダー (V1) のフローをテストします。

## <a name="provide-command-line-arguments-at-launch"></a>起動時にコマンドライン引数を指定します

Windows レコーダー (V1) のフローアクションを記録した後、デスクトップ フローが起動するアプリのコマンド ライン引数を指定することができます。 

以下の手順に従って、Windows レコーダー (V1) フローが起動するアプリにコマンド ライン引数を追加してください:

1.  デスクトップ レコーダーで Windows レコーダー (V1) のフローを記録します。 
1.  レコーダーで **完了** を選択し、アプリケーションの起動アクションを選択して展開します。
   
    スクリーンショットでは、例として Notepad++ を使用しています。 

    ![アプリケーションの起動ステップを表示します](../media/edit-desktop/cmd-line-app-launch-step.png "アプリケーションの起動ステップを表示します")


1. **詳細オプションの表示** を選択します。

   ![リンクを選択して詳細オプションを表示します](../media/edit-desktop/cmd-args-advanced.png "リンクを選択して詳細オプションを表示します")

1. ここにコマンドライン引数を指定します:

   ![コマンドライン引数のテキスト フィールドを表示します](../media/edit-desktop/cmd-args.png "コマンドライン引数のテキスト フィールドを表示します")

1.  アプリケーションに有効なコマンドライン引数を指定できます。

   >[!Important]
   >コマンドライン引数を介して、パスワードなどの機密テキストを渡さないでください。


## <a name="add-a-variable"></a>変数を追加する

変数を使用して、デスクトップ フロー内で複数のアクションを実行することができます。 たとえば、変数を使用して、ループで実行された操作の回数をカウントすることができます。 または、変数を使用して、ループにて画面の読み取りを行った文字列の配列を作成することもできます。

>[!TIP]
>整数、浮動小数点、ブール、文字列、配列、オブジェクト変数のデータ型を使用できます。 

変数を作成した後は、次のような他のタスクを実行できます :

- 変数を一定の値で増減させます。これは増分または減分とも呼ばれます。
- 文字列または配列の最後の項目として、変数の値を挿入または追加します。
- 変数に異なる値を割り当てます。

以下のステップに従って、UI フローで変数を作成して使用します :

1. Windows レコーダー (V1) フローの開始地点に移動し、**アクションの追加** を選択します。

   ![アクションの追加を選択する](../media/edit-desktop/add-variable-add-action.png "アクションの追加を選択する")

1. *変数* で検索を行い、続いて組み込みカテゴリ配下の **変数を初期化** アクションを選択します。

   ![変数の初期化アクションを選択する](../media/edit-desktop/add-variable-initialize-variable.png "変数の初期化アクションを選択する")

1. 変数を初期化して、要件を満たすタイプに設定します。

   ![変数を初期化して、要件を満たすタイプに設定する](../media/edit-desktop/add-variable-initialize-value.png "変数を初期化して、要件を満たすタイプに設定する")

>[!TIP]
>UI の自動化のシナリオで、ループ内で画面からの値の読み取りが含まれる場合は、変数を配列型として初期化することでこれを実現することができます。 
>
>続いて、UI フロー内で、**配列に追加** 変数アクションを選択し、次に動的コンテンツ リストから **テキストを取得t** アクションの結果を使用します。

   ![ループで配列に追加することができます](../media/edit-desktop/add-variable-add-loop.png "ループで配列に追加することができます")

## <a name="copy-and-paste-steps"></a>ステップのコピーと貼り付け

アクションとスコープをコピーするには、**アクションの追加** を使用して **マイ クリップボード** からコピーしたアクションとスコープを選択し、同じ Windows レコーダー (V1) フロー内の別の場所に貼り付けることができます。  

Power Automate デザイナーは、コピーされたアクションやスコープの名前を自動的に一意の名前に変更します。 コピーしたスコープに別のスコープが含まれている場合、**自分のクリップボード** から貼り付けたときに、ネストされた構造は、保持されます。 

>[!IMPORTANT]
>この機能は、同じスコープ内でのアクションのコピーと追加をサポートしています。 他のスコープや Windows レコーダー (V1) のフローにアクションを貼り付けることはできません。

次の手順に従って、アクションとスコープをコピーして貼り付けます:

1. **…** を選択し、コピーするアクションまたはスコープに対して **クリップボードにコピー** を選択します。

   ![コピー クリップボードの表示](../media/edit-desktop/copy-action.png "コピー クリップボードの表示")

1. ターゲットの場所にカーソルを合わせて、**アクションの追加** を選択します。 

   >[!TIP]
   >スコープや Windows レコーダー (V1) のフローの最後にある場合は、直接 **アクションの追加** を選択することができます。
      
   ![選択したアクションの追加](../media/edit-desktop/add-copied-action.png "選択したアクションの追加")

1.  **自分のクリップボード** を選択し、コピーしたアクションまたはスコープを選択します。

    ![コピーしたアクションの選択](../media/edit-desktop/select-action.png "コピーしたアクションの選択")

1. Power Automate が一意の名前のアクション カードを貼り付けていることに注目してください。

   ![コピーしたアクションの新しい名前を表示](../media/edit-desktop/action-unique-name.png "コピーしたアクションの新しい名前を表示")

1. また、スクリーンショットを含むアクションは、簡単に参照できるように保持されます。 

   ![保持されたスクリーンショットを表示](../media/edit-desktop/copied-screenshots.png "保持されたスクリーンショットを表示")

   ![その他の保持されたスクリーンショット](../media/edit-desktop/retained-screen-shorts.png "保持されたスクリーンショットを表示")


## <a name="paste-a-scope-immediately-after-itself"></a>スコープを直後に貼り付ける

>[!NOTE]
>スコープに **アプリケーションの終了** アクションがなく、ユーザーがスコープをコピーし、既存のスコープの直後にスコープを貼り付けた場合、貼り付けたアクションは最初のアプリケーション インスタンス内でのみ実行されます。 

   ![スコープの貼り付け](../media/edit-desktop/paste-scope-after-itself.png "スコープの貼り付け")


この例では、強調表示されたアクション **左クリック 11** と **キーボード操作の再生** が最初のメモ帳アプリケーションで実行され、別のメモ帳インスタンスが起動されます。 

このインスタンスの問題に対処するには、2 つのオプションがあります:

1. 最初のアプリケーション インスタンスでのみアクションを実行する場合は、最初のスコープで関連するアクションのみをコピーして貼り付けることができます。 スコープ全体を一度にコピーして貼り付ける場合は、貼り付けたスコープの起動アクションを削除して、無関係なアプリケーション インスタンスが起動しないようにする必要があります。

   ![関連するアクションのみ](../media/edit-desktop/copy-paste-relevant-actions-only.png "関連するアクションのみ")

1. 別のアプリケーション インスタンスでアクションを実行する場合は、最初のスコープで **アプリケーションの終了** を追加して、2番目のスコープが独自のインスタンスを持つようにすることができます。 

   ![個別のアプリケーション インスタンス](../media/edit-desktop/paste-scope-different-application.png "個別のアプリケーション インスタンス")


## <a name="add-a-loop"></a>ループの追加

Windows レコーダー (V1) は配列に対応しています。 配列を使用して、Windows レコーダー (V1) のフローで反復的なステップを実行するループを追加します。 クラウドフローから UI フローに異なるタイプの配列 (たとえば SharePoint リストからの複素配列など) を渡すことができます。

>[!NOTE]
>ループを追加するには、既存の Windows レコーダー (V1) フローを編集する必要があります。

UI フローでループを作成する手順は次のとおりです。

1. ループを追加する Windows レコーダー (V1) のフローを編集します。

   ![UI フローの編集ボタンを選択](../media/edit-desktop/edit-desktop-flow-loop.png "UI フローの編集ボタンを選択")

1. ウィザードの入力セクションに移動し、次に **入力を設定** を選択します。

   ![入力を設定](../media/edit-desktop/loops-input-section.png "入力を設定を選択")を選択
   

1. **配列** を選択し、配列入力タイプを作成することを示します。

   ![配列を選ぶ](../media/edit-desktop/loop-select-array-type.png "配列を選ぶ")

1. 名前、JSON 形式の配列、配列の説明など、配列の詳細を入力します。

   ![配列の詳細](../media/edit-desktop/loop-array-data.png "配列の詳細")

   >[!TIP]
   >SharePoint リストから複雑な配列を使用している場合では、配列を手動で作成する必要はありません。 クラウド フローから配列をコピーして、中央部のボックスに貼り付けます。

1. **次へ** を選択します。

1. **アクションの追加** を選択します。

1. 「Apply to each」を検索して **組み込み** を選択し、次に **Apply to each** を選択します。

   ![Apply to each アクションを選択](../media/edit-desktop/loop-apply-to-each.png "Apply to each アクションを選択")

1. **前のステップから出力を選択** を選択し、前に定義した配列を動的コンテンツから選択します。

   ![動的コンテンツから配列を追加](../media/edit-desktop/loop-add-array-step.png "動的コンテンツから配列を追加")

1. 繰り返すアクションをドラッグし、**Apply to each** カードにドロップします。

   たとえば、ここでは **LeftClick 4** を次の図の **Apply to each** カードにドロップしました。

   ![繰り返すステップを動的コンテンツから配列にドラッグ](../media/edit-desktop/loop-drag-apply-to-each.png "繰り返すステップを動的コンテンツから配列にドラッグ")

1. 記録中に作成された入力トークンを、必要に応じて配列の入力値に置き換えます。 

>[!TIP]
>配列が単純な文字列または整数配列の場合は、次の画像のように、**現在のアイテム** を動的コンテンツから直接使用できます。 式を使うこともできます。

![現在のアイテムを使用](../media/edit-desktop/loop-use-current-item.png)


### <a name="known-limitations"></a>既知の制限
1.  ループには静的セレクターが必要です。 つまり、反復アクションが発生するユーザー インターフェイス (UX) 要素は変更しないでください。 
1.  現在、出力操作はサポートされていません。
1.  Sharepoint リストのように、クラウド フローから渡す必要がある複雑な配列オブジェクトについては、そのオブジェクトのペイロードの例を入力してください。 ペイロードを取得するには、Windows レコーダー (V1) のフローの手順を使用せずにフローを実行し、配列を定義する際にアクションの出力を中央の (サンプルデータの追加) テキスト ボックスにコピーします。
1.  複雑な配列オブジェクト タイプには式を使用する必要があります。 たとえば、式 **items(‘Apply to each’)[‘<value>’]** を使用します。ここで、 <value> は、入力配列内の特定のオブジェクトの名前です。

## <a name="add-a-delay"></a>遅延を追加する

Windows レコーダー (V1) のフローはクラウド フローに追加することができます。

以下の手順に従って、記録した Windowsレコーダー (V1) のフローに遅延を追加します。

1. 対象とする箇所で、矢印にカーソルを合わせて **新しいステップを挿入する** を選択します。 または、**アクションの追加** を直接選択することで、スコープや UI フローの最後に追加することもできます。 

   ![遅延ステップを挿入する](../media/edit-desktop/insert-new-step-delay.png)

1. **アクションの追加** を選択します。

   ![遅延アクションを追加する](../media/edit-desktop/add-delay-action.png)

1. **内蔵** を選択し、「遅延」を検索します。 
   または、**スケジュール** > **遅延** を選択することもできます。

   ![予測アクションを検索する](../media/edit-desktop/search-delay.png)

1. **集計** を入力します。たとえば「 2 」と入力すると **単位** の数を表します。
1. **単位** を選択します。たとえば **分** を選択すると、遅延の時間の長さを表します。

   次の画像では、2分の遅延が発生していることを示しています。 

   ![遅延を定義する](../media/edit-desktop/delay-details.png)

   Windows レコーダ (V1) のフローに遅延アクションを追加しました。 以上で、フローが実行された際に、後続のアクションが実行される前に定義された通りの遅延が発生します。


## <a name="add-a-retry-policy"></a>再試行ポリシーを追加する

既定では、Windows レコーダー (V1) は、既定の再試行設定とタイムアウト値を使用して、失敗した UI の自動化手順を再試行します。

これらの手順に従って、Windows レコーダー (V1) のフローを記録した後、特定の手順に対して独自の再試行ポリシーを設定します。

1. 再試行ポリシーを変更するステップで **...** を選択します。
1. **設定** を選択します。

   ステップの設定カードが開きます。

   ![設定カードを開く](../media/edit-desktop/open-retry-settings.png)
   

1. **期間** ボックスにタイムアウト値を追加します。 

   タイムアウト期間は、1 分から 24 時間の間です。 たとえば、次の形式でタイムアウト期間を入力する必要があります。**PT1M** は 1 分のタイムアウト期間を表し、**PT24H** は 24 時間のタイムアウトを表します。

   ![再試行ポリシーカード](../media/edit-desktop/retry-policy-card.png)

   タイムアウトは、Windows レコーダー (V1) フローが完了できないアクションをキャンセルする前に実行を試みる時間の長さを指定する値です。 アクションがキャンセルされると、再試行ポリシーが開始されます。 既定のタイムアウト値は 5 分です。 

   Windows レコーダー (V1) のフローでは、3 種類の再試行があります。

   - 既定
   - いいえ​​ 
   - カスタム
   
既定では、**既定** オプションが選択されます。 この既定値は、9 回再試行するようにに設定されています。 最初の試行を含め、これは合計 10 回の試行を意味します。 再試行間隔は 1 秒になっています。

**なし** オプションを選択した場合、このステップでは再試行は行われません。

カスタムの再試行ポリシーを指定する場合は、**カスタム** オプションを選択し、**再試行回数**  と **間隔の長さ** に値を入力します。                    


>[!NOTE]
>再試行ポリシーは、すべてのステップで使用できるわけではありません。 再試行オプションが表示されない場合、そのポリシーは特定のステップで利用できないことを意味します。

## <a name="add-a-manual-action"></a>手動アクションの追加

アクションを少なくとも 1 つ含めてアプリケーションを記録したら、そのアプリケーションに対して次のアクションを手動で追加できます。

| **Action**          | **コメント**                                                       |
|---------------------|-------------------------------------------------------------------|
| アプリケーションを閉じる   |                                                                   |
| 右クリック         |                                                                   |
| キーの送信           | キーや、CTRL + C など、キーの組み合わせを送信します。                             |
| 左クリック          |                                                                   |
| テキストの取得            | ユーザー インターフェイス要素からテキストを読み取り、それを出力として使用します。 |
| テキストの入力          |                                                                   |
| 有効な要素の取得 | ユーザー インターフェイス要素が有効になっているか、無効になっているか確認します。         |
| 要素のクリア       | 編集可能なユーザー インターフェイス要素の値を消去します。             |
| 数秒待機する    | 次のステップに進むまで待機します。                           |

以下の手順で手動アクションを追加します:

1. [Power Automate](https://flow.microsoft.com) にサインインする。
1. **マイ フロー** > **デスクトップ フロー** を選択します。
1. 編集する Windows レコーダー (V1) のフローを選択します。

   ![編集する Windows レコーダー (V1) のフロー](../media/edit-desktop/select-desktop-flow.png)

1. **編集** を選択します。 
1. 新しいステップを追加するステップが含まれるレコーディング カードを選択します。
   カードが展開され、記録されているステップが表示されます。

   ![レコーディング カードの選択](../media/edit-desktop/manual-select-recording-card.png)

1. レコーディング カードで、最後に記録したステップのすぐ下で **アクションの追加** を選択します。
   このチュートリアルで前にリストアップした手動アクションの一覧が表示されます。 

1. 追加するアクションを選択します。 今回は **有効な要素の取得** を選択しましたが、自分のシナリオに適したアクションを選択できます。

   ![add.png へのアクションを選択](../media/edit-desktop/select-action-to-add.png)

アクションが追加されたら、アクションの詳細オプションで **セレクター** を設定する必要があります。

![アクションの詳細オプション](../media/edit-desktop/action-advanced-options.png "アクションの詳細オプション")

### <a name="set-the-selector"></a>セレクターの設定

セレクターにより、再生中、アクションが実行されるユーザー インターフェイス要素が特定されます。 可能であれば、同じユーザー インターフェイス要素をターゲットにする別のステップからこの情報をコピー/貼り付けすることをおすすめします。

セレクターの形式は次のとおりです:

```json
{  
   "type":"WinUIA",
   "parameters":{  
      "elementStack":[  

      ],
      "elementXPath":""
   }
}
```

セレクター要素の **elementStack** フィールドと **elementXPath** フィールドにデータを指定する必要があります。

**elementStack** は次の例のようになります。

![要素スタック](../media/edit-desktop/elementstack.png "要素スタック")

[WinAppDriver UI レコーダー](https://blogs.windows.com/windowsdeveloper/2018/06/20/introducing-winappdriver-desktop-recorder/) を利用して **elementXPath** をキャプチャできます。

![WAD ツール](../media/edit-desktop/wad-tool.png "WAD ツール")

セレクターの **elementXPath** の結果を使用する前に、最初の要素 (/Window の前にあるもの全部) を削除します。

Windows レコーダー (V1) のフローをテストして、セレクターが正しく動作することを確認してください。

## <a name="use-advanced-controls"></a>詳細コントロールを使用する

**条件**、**ケースの切り替え**、**終了** アクションなどの高度なコントロールをデスクトップ フローに組み込むことができます。

既存の Windows レコーダー (V1) のフローを使用し、以下の手順でこれらの高度な操作を行うことができます。

1. 作成した Windows レコーダー (V1) のフローを選択し、> **その他のコマンド** (...) > **編集** にアクセスします。

1. Windows レコーダー (V1) のフローの手順の下矢印の、**+** > **アクションの追加** を選択肢、ロジックを追加します。

   ![アクションを追加します](../media/edit-desktop/add-action.png)

1. **組み込み** を選択し、使用可能なコントロール アクションの 1 つを選択します。

   ![組み込み](../media/edit-desktop/select-built-in.png)

1. 評価する必要がある式を入力します。 動的なコンテンツと式を使用して、条件を評価し、コントロールを切り替えることができます。 さらに、前段階の Windows レコーダー (V1) のフローの手順で生成された出力をすべて使用することができます。

   ![条件カード](../media/edit-desktop/condition-card.png)


## <a name="add-a-recording-of-a-remote-computer-using-image-recognition"></a>画像認識を利用したリモート コンピューターの記録を追加する 

[!INCLUDE[cc-beta-prerelease-disclaimer](../includes/cc-preview-features-expect-changes.md)]

Windows レコーダー (V1) の画像認識はプレビュー機能であり、現在はリモート デスクトップ接続 (RDC) アプリを使ってリモート コンピューターを記録する際に利用できます。
 

## <a name="what-is-image-recognition"></a>画像認識とは?

現在、Windows レコーダー (V1) のフローは、アクセシビリティ API (UI の自動化と WinAppDriver) を利用して、主に Microsoft Windows の UI ツリー内のコントロールを検出して記録しています。 Web ベースのアプリや Java アプリなどでは、UI ツリーが利用できない場合があります。 コントロールの ID が頻繁に、またはセッション間で変更される場合など、UI ツリーが信頼できない場合があります。 

画像認識により、クリック位置やその他の詳細が再生中に視覚的に一致し、自動化できるアプリケーションの範囲が大幅に拡大されます。

## <a name="use-image-recognition-to-record-a-remote-computer"></a>画像認識を使用してリモート コンピューターを記録する

1. 新規または既存の Windows レコーダー (V1) フローで、[入力] タブに移動して、リモート デバイスへのログインに使用するユーザー名とパスワードの 2 つの新しい **機密なテキスト** 入力を作成します。 機密なテキスト入力では、Windows レコーダー (V1) フローをテストしたり、他のフローから Windows レコーダー (V1) フローを呼び出したりする際に、Windows レコーダー (V1) フロー自体が保存したりログに記録したりすることなく、動的に値を入力することができます。

   ![機密テキスト ](../media/create-remote-desktop/ir-sensitive-text.png)

1. **記録の追加** に記載の手順に従い、新規または既存の Windows レコーダー (V1) フローのレコーダー コントロールを起動します。

1. リモート デスクトップ アプリを使用して、リモート コンピューターに接続します。

1. リモート デスクトップ ウィンドウを全画面に展開します。

1. レコーダー コントロールから **記録** を選択し、表示されるアラートで **OK** を選択します。

   ![ポップアップ](../media/create-remote-desktop/popup.png)

1. リモート コンピューターで手順を実行してから、レコーダー コントロール上で **完了** を選択します。

1. レコーディング内で **リモート デスクトップを起動** アクションを検索し、ユーザー名とパスワードの機密性の高いテキスト入力を入力します。

![ユーザー名とパスワードの機密性の高いテキスト](../media/create-remote-desktop/ir-launch-emote_desktop-session.png)

1. **保存** を選択し、Windows レコーダー (V1) のフローをテストします。

>[!IMPORTANT]
>自動化されたフローからこの Windowsレコーダー (V1) フローを呼び出す場合は、[Azure Key Vault](https://azure.microsoft.com/services/key-vault/) などのキー管理ソリューションを使用して、ユーザー名とパスワードを取得し、それらをフロー自体に保存するのではなく、Windows レコーダー (V1) フロー内の **機密テキスト** 入力に動的に渡すことを推奨します。 

>[!TIP]
> Windows レコーダー (V1) のフローを呼び出しているフローで、 **Windows レコーダー (V1) で構築されたフローを実行する** アクションの **設定** メニューで **セキュアな入力** を有効にします。 これにより、入力が実行履歴に保存されなくなります。

## <a name="use-image-recognition-to-record-on-citrix"></a>画像認識を使用して Citrix に記録する

Windowsレコーダー (V1) を使用して Citrix に記録するには、2 つのオプションがあります。

### <a name="option-1-record-a-citrix-application-or-desktop-already-open-on-your-machine"></a>オプション1：マシン上で開いている Citrix アプリケーションまたはデスクトップを記録する

1.  [記録の追加](#add-a-recording)に記載の手順に従い、新規または既存の Windows レコーダー (V1) フローのレコーダー コントロールを起動します。
1.  Citrix アプリまたはリモート デスクトップを使用して、リモート コンピューターに接続します。

   ![Citrix アプリの表示](../media/edit-desktop/citrix-app-remote.png)

1.  Citrix リモート デスクトップを使用している場合は、ウィンドウを全画面表示に拡大します。
1.  レコーダーコントロールで **記録する** を選択し、続いて表示されるアラートで **了解** を選択します。
1.  Citrix でステップを実行し、続いてレコーダーコントロール上で **完了** を選択します。

>[!TIP]
>Windows レコーダー (V1) を使用すると、同じセッション中に複数の Citrix アプリを記録することができます。 Citrix ワークスペースの起動を記録していない場合は、記録を開始する前にすべてのアプリケーションを開きます。

### <a name="option-2-record-the-launch-of-your-citrix-application--desktop-from-your-citrix-workspace"></a>オプション 2 : Citrix ワークスペースから、Citrix ワークスペース /デスクトップの起動を記録する

1.  [記録の追加](#add-a-recording)に記載の手順に従い、新規または既存の Windows レコーダー (V1) フローのレコーダー コントロールを起動します。
1.  タスクバーから Citrix ワークスペースを開きます。
1.  パスワードを入力し、**ログオン** を選択します。
  
    >[!TIP]
    >**パスワードを記憶する** を選択しない場合は、**機密テキスト** 入力を使用してください。

    ![Citrix アプリのパスワードを入力します](../media/edit-desktop/citrix-app-password.png)

1. 記録するアプリ、またはデスクトップを選択します。

   ![記録するアプリの一覧を表示する](../media/edit-desktop/citrix-select-app-record.png)

1.  Citrix でステップを実行し、続いてレコーダーコントロール上で **完了** を選択します。

   >[!IMPORTANT]
   >ログオンのステップを記録した場合は、デザイナーでは 3 つの Citrix スコープアプリケーションが表示されます。 これは、ログオン ウィンドウが Citrix ワークスペースとは別のアプリケーションであるため、想定される挙動です。

   >[!TIP]
   >テストモードと有人モードでは、Windows レコーダー (V1) のフローを再生する前に、Citrix のワークスペースが閉じていることを確認してください。 通知バーから、Citrix アイコンを右クリックし、**閉じる** を選択してワークスペースを閉じます。


#### <a name="troubleshooting"></a>トラブルシューティング​​

ログイン ウィンドウで機密テキストの使用に問題がある場合は以下を参照してください：
1. レコーダーから入力メニューを開きます。
1. パスワードのフィールドを選択します。
1. 入力メニューで機密テキスト (この例では「パスワード」) を選択します。

   ![パスワードには機密テキストを使用してください](../media/edit-desktop/citrix-app-sensitive-text.png)


## <a name="use-ocr-to-extract-text-from-images"></a>OCR を使用して画像からテキストを抽出する

1. ステップを記録しながら、キャプチャするテキストの場所に移動します。

1. レコーダー コントロールから **アウトプット** > **画像からテキストを抽出** を選択します。

1. プロンプトに従って、**アンカー エリア** (フィールドの横のラベルなど、変更が予想されない画面のセクション) を選択します。

    ![アンカー エリア](../media/create-remote-desktop/ir-anchors.png)

1.  **対象領域** (OCR を使用してテキストが抽出される領域) を選択します。

    ![対象地域](../media/create-remote-desktop/ir-targets.png)

1.  出力の名前を入力します。

1.  レコーダー コントロール上の **完了** を選択します。

1.  **保存** を選択し、Windows レコーダー (V1) のフローをテストします。


### <a name="known-issues-for-remote-desktop-recordings"></a>リモート デスクトップ レコーディングに関する既知の問題

1. 同じ Windows レコーダー (V1) のフローで次の手順を記録する前に、必要な入力 (コンピュータ名、ユーザー名、パスワード) がすべて記入され、保存されていることを確認してください。

1. 既存のリモート デスクトップ セッションに添付するには、同じ Windows レコーダー (V1) のフローでセッションが既に起動している必要があります。

1. 記録時にリモート デスクトップ接続 (RDC) を起動する場合は、[スタート] メニューのリモート デスクトップ接続アプリ (mstc.exe) を使用することをお勧めします。 **リモート デスクトップを起動** アクションに加えて "Windows セキュリティ" アクションが記録されている場合は、再生が中断されないようにデザイナーから削除する必要があります (これは、リモート デスクトップ セッションがショートカットから起動されたときに発生する可能性があります)。

1. 画面のスケーリングが 100% 以外の値に設定されている画面で Windows レコーダー (V1) のフローが記録されている場合は、再生に失敗することがあります。 回避策として、レコーディングする前に画面のスケーリングが 100% に設定されていることを確認してください。


## <a name="handle-error-conditions"></a>エラー状況を処理する

再生中に予期しない状況が発生することがあります。 これらの条件は、デスクトップ フローが失敗する原因となります。 高度なエラー処理機能を使用すると、予期しない状況が発生した場合の代替ステップを作成できます。 

このステップを以下に示します。

1. 職場または学校のアカウントで [Power Automate](https://powerautomate.microsoft.com) にサインインする。
1. **マイ フロー** > **デスクトップ フロー** を選択します。
1. **その他のコマンド** (編集する Windowsレコーダー (V1) のフローの縦に並んだ 3 つのドット) を選択します。
1. **編集** を選択します。
1. エラー処理を追加する Windows レコーダー (V1) のフローの手順の直前にある下向き矢印を選択し、**+** (新しい手順の挿入) を選択します。
   
   次の画像では、**PostElementText 1** ステップの前に新しいステップを挿入しています。 これは **PostElementText 1** が失敗した場合に、次に定義する代替ステップが実行されることを意味します。

      ![新しいステップの挿入の画像](../media/edit-desktop/insert-new-step.png) 

1. **並列分岐の追加** を選択します。

    ![並列分岐とその他のオプションの追加を示す画像](../media/edit-desktop/add-parallel-branch.png)

1. Windows レコーダー (V1) フローの実行時に障害が発生した場合に、並列分岐で実行するアクションを選択します。

   **アプリの記録** を選択して並列分岐の新規記録を行うか、**内蔵** アクションから **終了** を選択して、障害が発生した場合に Windows レコーダー (V1) のフロー終了を適切に終了させることができます。

    ![並列分岐のオプションを示す画像](../media/edit-desktop/add-parallel-branch.png)

   >[!NOTE]
   >既定では、並列分岐に追加したアクションは、前のステップが失敗した場合にのみ実行されます。 並列分岐で **...** > **実行後の構成** の順に選択して既定の動作を変更することができます。 

      ![実行後の構成などのオプションを示す画像](../media/edit-desktop/configure-run-after.png)

1.  この画面では、並列分岐を実行する条件を選択できます。 4 つのオプションのいずれかを選択できます。

    ![実行後オプションを示す画像](../media/edit-desktop/run-after-options.png)

    注意: 主分岐と並列分岐の両方が同じ条件で実行するように設定した場合、 Windows レコーダー (V1) フローは保存できません。



## <a name="enable-coordinate-based-playback"></a>座標ベースの再生の有効化

座標ベースの再生では、既定の Windows UI オートメーション フレームワークでは再生中に見つけられないターゲット オブジェクトを Windows レコーダー (V1) で見つけやすくするフォールバックとして、相対的な画面座標オフセットを使用します。 

既定の Windows UI オートメーション フレームワークが、ターゲット オブジェクトを再生中に見つけられない理由を次にいくつか示します:

- 自動化しているレガシ アプリケーションで、Windows UI オートメーション フレームワークをサポートするプログラミング テクノロジが使用されていない。
- アプリケーションまたはそのコントロールの UI オートメーション XPath、名前、または ID が一意でない。 
- アプリケーションに、名前または ID が変更される可能性があるダイナミック コントロールがある。 
- アプリケーションに、名前、ID、一意の識別子などのないコントロールがある。

>[!TIP]
>座標ベースの再生の精度を向上させるには、同じスケールと解像度を使用し、また記録中に対象アプリケーションを最大化します。

Windows レコーダー (V1) のフロー スクリプトを記録した後は、以下の手順に従ってください。

1. アプリケーションを起動または接続する手順を展開します。
   
   これは通常、記録スクリプトの最初のステップです。
1. **詳細オプションの表示** を選択します。
1. **座標の再生の使用** プロパティを検索します。
1. 一覧から **はい** を選択し、座標ベースの再生を有効にします。

>[!TIP]
> そのアプリケーションに実行したすべての手順にこの設定を適用するには、各アプリケーションで **座標の再生の使用** を有効または無効にします。  


>[!WARNING]
>座標ベースの再生では、ターゲット アプリケーションの UI が大幅に変更されたなどのさまざまな理由により、ターゲット アプリケーションの一部ではないコントロールをオートメーションが選択する場合があります。


## <a name="next-steps"></a>次の手順

- 編集した [ UI フローを実行する](run-desktop-flow.md) 方法について学習します。

- デスクトップ フローをさらに活用する場合は、[入力と出力](inputs-outputs-desktop.md) のパラメーターを作成することもできます。

