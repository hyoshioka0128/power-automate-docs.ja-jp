---
title: デスクトップ UI フローの編集方法を学習する | Microsoft Docs
description: デスクトップ UI フローの編集方法を学習する
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: kvivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 11/04/2019
ms.author: DeonHe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: e56c6559c78de3bed4dabddaffb9c02c8be49631
ms.sourcegitcommit: c1c73952bb799a1fe48f2eb4f0c8dc7dd8614ff1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/17/2020
ms.locfileid: "79437295"
---
# <a name="edit-desktop-ui-flows"></a>デスクトップ UI フローの編集

[このトピックはプレリリース版のドキュメントであり、変更される可能性があります。]

[!INCLUDE [view-pending-approvals](../includes/cc-rebrand.md)]

デスクトップ UI フローにより、Windows デスクトップ アプリケーションが自動化されます。 発生する可能性のある問題、その問題の回避策、このプレビュー リリースではサポートされていないシナリオの詳細については、[既知の問題](create-desktop.md#known-issues-and-solutions)を参照してください。

## <a name="prerequisites"></a>前提条件
デスクトップ UI フロー。 編集するデスクトップ UI フローがない場合、[今から作成してください](create-desktop.md#create-and-test-desktop-ui-flows)。

## <a name="edit-actions"></a>編集アクション

![編集アクション](../media/edit-desktop/edit-actions.png "編集アクション")

次の目的でレコーディングを編集できます。

-   レコーディングをサポートするアクションの値を編集します。
-   ステップを削除します。
-   レコーディング全体を削除します。
-   ドラッグ アンド ドロップでアクションの順序を変更します。 レコーディングの整合性を壊す可能性があるため、これは慎重に行ってください。

高度なパラメーターで次を変更できます。

-  アクション実行後の遅延。 たとえば、PT0S を PT1S に変更することで 1 秒の遅延を追加できます。 これは、ターゲット アプリケーションの応答が遅く、UI フローの次のステップ前に完了しないときに便利です。
-   ターゲット ユーザー インターフェイス要素の[セレクター](edit-desktop.md#set-the-selector)。


## <a name="add-a-recording"></a>レコーディングの追加

UI フローを複数のセッションで記録することがあります。 最初のレコーディングが完了したら、次のように進めることができます。

1. [Power Automate](https://flow.microsoft.com) にサインインします。
1. **[マイフロー]** 、 **[UI フロー (プレビュー)]** の順に選択します。
1. 編集する UI フローを選択します。
   ![](../media/edit-desktop/select-ui-flow.png)
1. **[編集]** をクリックします。 
1. **[新しいステップ]** を選択します。

   ![新しいステップ](../media/edit-desktop/new-step.png "新しいステップ")

1. アクションの一覧から **[アプリの記録]** を選択します。

   ![アプリの記録](../media/edit-desktop/select-record-ui-actions.png "アプリの記録")

1. **[レコーダーの起動]** を選択します。

   ![[レコーダーの起動] の選択](../media/create-windows-ui-flow/select-launch-recorder.png "[レコーダーの起動] の選択")

   レコーダー コントロールが画面の上部に表示されます。

   ![レコーダー コントロール](../media/create-windows-ui-flow/recorder-control.png "レコーダー コントロール")

1. 記録するアプリを開始します。

     >[!TIP]
     >アプリのコントロールにマウスを置くと、各コントロールが青の枠線で強調表示されます。 コントロールを選択する前に、常に青の強調表示を待ちます。
     >
     >要素の周囲に青の強調表示が表示されない場合は、適切に記録されていない可能性があります。

1. レコーダー コントロールから **[記録]** を選択します。

1. 記録しているアプリのユーザー インターフェイスでステップを実行し、レコーダー コントロールで **[完了]** を選択します。
1. **[保存]** を選択し、UI フローをテストします。

## <a name="add-a-manual-action"></a>手動アクションの追加

アクションを少なくとも 1 つ含めてアプリケーションを記録したら、そのアプリケーションに対して次のアクションを手動で追加できます。

| **操作**          | **コメント**                                                       |
|---------------------|-------------------------------------------------------------------|
| アプリケーションの終了   |                                                                   |
| 右クリック         |                                                                   |
| キーの送信           | キーや、CTRL + C など、キーの組み合わせを送信します。                             |
| 左クリック          |                                                                   |
| テキストの取得            | ユーザー インターフェイス要素からテキストを読み取り、それを出力として使用します。 |
| テキストを入力する          |                                                                   |
| 要素の有効/無効を取得 | ユーザー インターフェイス要素が有効になっているか、無効になっているか確認します。         |
| 要素のクリア       | 編集可能なユーザー インターフェイス要素の値を消去します。             |
| 数秒待機する    | 次のステップに進むまで待機します。                           |

以下の手順で手動アクションを追加します。

1. [Power Automate](https://flow.microsoft.com) にサインインします。
1. **[マイフロー]** 、 **[UI フロー (プレビュー)]** の順に選択します。
1. 編集する UI フローを選択します。
   ![](../media/edit-desktop/select-ui-flow.png)
1. **[編集]** をクリックします。 
1. 新しいステップを追加するステップが含まれるレコーディング カードを選択します。
   カードが展開され、記録されているステップが表示されます。

   ![レコーディング カードの選択](../media/edit-desktop/manual-select-recording-card.png)

1. レコーディング カードで、最後に記録したステップのすぐ下で **[アクションの追加]** を選択します。
   このチュートリアルで前にリストアップした手動アクションの一覧が表示されます。 

1. 追加するアクションを選択します。 今回は **[要素の有効/無効を取得]** を選択しましたが、自分のシナリオに適したアクションを選択できます。

   ![Select action to add.png](../media/edit-desktop/select-action-to-add.png)

アクションが追加されたら、アクションの詳細オプションで **[セレクター]** を設定する必要があります。

![アクションの詳細オプション](../media/edit-desktop/action-advanced-options.png "アクションの詳細オプション")

### <a name="set-the-selector"></a>セレクターの設定

セレクターにより、再生中、アクションが実行されるユーザー インターフェイス要素が特定されます。 可能であれば、同じユーザー インターフェイス要素をターゲットにする別のステップからこの情報をコピー/貼り付けすることをおすすめします。

セレクターの形式は次のとおりです。

```json
{  
   "type":"WinUIA",
   "parameters":{  
      "elementStack":[  

      ],
      "elementXPath":""
   }
}
```

セレクター要素の **[elemementStack]** フィールドと **[elementXPath]** フィールドにデータを指定する必要があります。

**elemementStack** は次の例のようになります。

![要素スタック](../media/edit-desktop/elementstack.png "要素スタック")

[WinAppDriver UI レコーダー](https://blogs.windows.com/windowsdeveloper/2018/06/20/introducing-winappdriver-ui-recorder/)を利用して **elementXPath** をキャプチャできます。

![WAD ツール](../media/edit-desktop/wad-tool.png "WAD ツール")

セレクターの **elementXPath** の結果を使用する前に、最初の要素 (/Window の前にあるもの全部) を削除します。

UI フローをテストし、セレクターが正しく機能することを確認します。

## <a name="use-advanced-controls"></a>詳細コントロールを使用する

UI フロー内に、**条件**、**スイッチ ケース**、**終了**アクションなどの詳細コントロールを組み込むことができます。

これらの詳細な操作を実行するには、既存の UI フローで次の手順を行います。

1. 作成した UI フローを選択し、 **[その他のコマンド]** ([...]) > **[編集]** を選択します。

1. ロジックを追加する UI フロー ステップの下矢印で、 **[+]**  >  **[アクションの追加]** を選択します。

   ![アクションの追加](../media/edit-desktop/add-action.png)

1. **[組み込み]** を選択し、使用可能なコントロール アクションの 1 つを選択します。

   ![組み込み](../media/edit-desktop/select-built-in.png)

1. 評価する必要がある式を入力します。 動的なコンテンツと式を使用して、条件を評価し、コントロールを切り替えることができます。 また、前の UI フロー ステップで生成された出力を使用することもできます。

   ![条件カード](../media/edit-desktop/condition-card.png)


## <a name="handle-error-conditions"></a>エラー処理の条件

再生中に予期しない状態が発生し、UI フローが失敗することがあります。 高度なエラー処理機能を使用すると、予期しない状態が発生した場合の代替ステップを作成できます。 

このステップを以下に示します。

1. 職場または学校アカウントを使用して、[Power Automate](https://powerautomate.microsoft.com) にサインインします。
1. UI フローを表示するには、 **[マイ フロー]**  >  **[UI flows]** の順に選択します。
1. **[その他のコマンド]** (編集する UI フローの 3 つの垂直ドット) を選択します。
1. **[編集]** をクリックします。
1. エラー処理を追加する UI フロー ステップの直前にある下矢印を選択し、 **+** (新しいステップの挿入) を選択します。
   
   次の画像では、**PostElementText 1** ステップの前に新しいステップを挿入しています。 これは **PostElementText 1** が失敗した場合に、次に定義する代替ステップが実行されることを意味します。

      ![新しいステップの挿入の画像](../media/edit-desktop/insert-new-step.png) 

1. **[Add a parallel branch]\(パラレル分岐の追加)** を選択します。

    ![並列分岐とその他のオプションの追加を示す画像](../media/edit-desktop/add-parallel-branch.png)

1. UI フローの実行中にエラーが発生した場合に、並列分岐で実行するアクションを選択します。

   **[アプリの記録]** を選択すると、並列分岐の新しい記録を実行できます。または、エラーが発生した場合に UI フローが正常に終了するように **[組み込み]** アクションから **[終了]** を選択します。

    ![並列分岐のオプションを示す画像](../media/edit-desktop/add-parallel-branch.png)

   >[!NOTE]
   >既定では、並列分岐に追加したアクションは、前のステップが失敗した場合にのみ実行されます。 並列分岐で **[...]** > **[実行条件の構成]** の順に選択して既定の動作を変更することができます。 

      ![[実行条件の構成] が含まれるオプションを示す画像](../media/edit-desktop/configure-run-after.png)

1.  この画面では、並列分岐を実行する条件を選択できます。 4 つのオプションのいずれかを選択できます。

    ![実行条件のオプションを示す画像](../media/edit-desktop/run-after-options.png)

    注意:同じ条件で実行されるメイン分岐と並列分岐の両方のセットを含む UI フローを保存することはできません。



## <a name="enable-coordinate-based-playback"></a>座標ベースの再生の有効化

座標ベースの再生では、フォールバックとして、既定の Windows UI オートメーション フレームワークが再生中に見つけることができないターゲット オブジェクトを UI flows が検索できるようにする、相対的な画面座標オフセットが使用されます。 

既定の Windows UI オートメーション フレームワークが、ターゲット オブジェクトを再生中に見つけられない理由を次にいくつか示します。

- 自動化しているレガシ アプリケーションで、Windows UI オートメーション フレームワークをサポートするプログラミング テクノロジが使用されていない。
- アプリケーションまたはそのコントロールの UI オートメーション XPath、名前、または ID が一意でない。 
- アプリケーションに、名前、ID が変更される可能性があるダイナミック コントロールがある。 
- アプリケーションに、名前、ID、一意の識別子などのないコントロールがある。

>[!TIP]
>座標ベースの再生の精度を向上させるには、同じスケールと解像度を使用し、また記録中に対象アプリケーションを最大化します。

UI flow スクリプトの記録後、次の手順に従います。

1. アプリケーションを起動または接続する手順を展開します。
   
   これは、通常記録スクリプトの最初の手順です。
1. **[詳細オプションの表示]** を選択します。
1. **[Use coordinate playback]** \(座標の再生の使用\) プロパティを検索します。
1. 一覧から **[はい]** を選択し、座標ベースの再生を有効にします。

>[!TIP]
> そのアプリケーションに実行したすべての手順にこの設定を適用するには、各アプリケーションで **[Use coordinate playback]** \(座標の再生の使用\) を有効または無効にします。  


>[!WARNING]
>座標ベースの再生では、ターゲット アプリケーションの UI が大幅に変更されたなどのさまざまな理由により、対象アプリケーションの一部ではないコントロールがオートメーションで選択される場合があります。




## <a name="next-steps"></a>次の手順

- 編集した[ UI フローを実行する](run-ui-flow.md)方法について学習します。

- UI フローでさらに多くの操作を行う場合は、[入力と出力](inputs-outputs-web.md)パラメーターを使用して UI フローを試すこともできます。

