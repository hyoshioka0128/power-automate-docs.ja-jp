---
title: デスクトップ UI フローの編集方法を学習する | Microsoft Docs
description: デスクトップ UI フローの編集方法を学習します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: kvivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/24/2020
ms.author: DeonHe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: a6b34a58dc028d6d0df9bf03f66a04666998ac69
ms.sourcegitcommit: aefd1ebedfbd8c6cc3d08397ac171cb4ba5b5315
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/30/2020
ms.locfileid: "3412984"
---
# <a name="edit-desktop-ui-flows"></a>デスクトップ UI フローの編集

デスクトップ UI フローにより、Windows デスクトップ アプリケーションが自動化されます。 発生する可能性のある問題、その問題の回避策、このリリースではサポートされていないシナリオの詳細については、[既知の問題](create-desktop.md#known-issues-and-solutions) を参照してください。

## <a name="prerequisites"></a>前提条件
デスクトップ UI フロー。 編集するデスクトップ UI フローがない場合、[今すぐデスクトップ UI フローを作成してください](create-desktop.md#create-and-test-desktop-ui-flows)。

## <a name="edit-actions"></a>アクションの編集

![アクションの編集](../media/edit-desktop/edit-actions.png "アクションの編集")

レコーディングを次のように編集できます:

-   レコーディングをサポートするアクションの値を編集します。
-   ステップを削除します。
-   レコーディングを削除します。
-   ドラッグ アンド ドロップでアクションの順序を変更します。 レコーディングの整合性を壊す可能性があるため、これは慎重に行ってください。

詳細パラメーターで次を変更できます:

-  アクション実行後の遅延。 たとえば、PT0S を PT1S に変更することで 1 秒の遅延を追加できます。 これは、ターゲット アプリケーションの応答が遅く、UI フローの次のステップ前に完了しないときに便利です。
-   ターゲット ユーザー インターフェイス要素の [セレクター](edit-desktop.md#set-the-selector)。


## <a name="add-a-recording"></a>レコーディングの追加

UI フローを複数のセッションで記録することがあります。 最初のレコーディングが完了したら、次のように進めることができます:

1. [Power Automate](https://flow.microsoft.com) にサインインする。
1. **マイ フロー** > **UI フロー** の順に選択します。
1. 編集する UI フローを選択します。
   ![](../media/edit-desktop/select-ui-flow.png)
1. **編集**を選択します。 
1. **新しいステップ**を選択します。

   ![新しいステップ](../media/edit-desktop/new-step.png "新しいステップ")

1. アクションの一覧から **アプリの記録** を選択します。

   ![アプリの記録](../media/edit-desktop/select-record-ui-actions.png "アプリの記録")

1. **レコーダーの起動** を選択します。

   ![[レコーダーの起動] の選択](../media/create-windows-ui-flow/select-launch-recorder.png "[レコーダーの起動] の選択")

   レコーダー コントロールが画面の上部に表示されます。

   ![レコーダー コントロール](../media/create-windows-ui-flow/recorder-control.png "レコーダー コントロール")

1. 記録するアプリを開始します。

     >[!TIP]
     >アプリのコントロールにマウスを置くと、各コントロールが青の枠線で強調表示されます。 コントロールを選択する前に、必ず青い強調表示を待ってください。
     >
     >要素の周囲に青の強調表示が表示されない場合は、適切に記録されていない可能性があります。

1. レコーダー コントロールから **記録** を選択します。

1. 記録しているアプリのユーザー インターフェイスでステップを実行し、レコーダー コントロールで **完了** を選択します。
1. **保存** を選択し、UI フローをテストします。

## <a name="add-a-manual-action"></a>手動アクションの追加

アクションを少なくとも 1 つ含めてアプリケーションを記録したら、そのアプリケーションに対して次のアクションを手動で追加できます。

| **Action**          | **コメント**                                                       |
|---------------------|-------------------------------------------------------------------|
| アプリケーションを閉じる   |                                                                   |
| 右クリック         |                                                                   |
| キーの送信           | キーや、CTRL + C など、キーの組み合わせを送信します。                             |
| 左クリック          |                                                                   |
| テキストの取得            | ユーザー インターフェイス要素からテキストを読み取り、それを出力として使用します。 |
| テキストの入力          |                                                                   |
| 有効な要素の取得 | ユーザー インターフェイス要素が有効になっているか、無効になっているか確認します。         |
| 要素のクリア       | 編集可能なユーザー インターフェイス要素の値を消去します。             |
| 数秒待機する    | 次のステップに進むまで待機します。                           |

以下の手順で手動アクションを追加します:

1. [Power Automate](https://flow.microsoft.com) にサインインする。
1. **マイ フロー** > **UI フロー** の順に選択します。
1. 編集する UI フローを選択します。
   ![](../media/edit-desktop/select-ui-flow.png)
1. **編集**を選択します。 
1. 新しいステップを追加するステップが含まれるレコーディング カードを選択します。
   カードが展開され、記録されているステップが表示されます。

   ![レコーディング カードの選択](../media/edit-desktop/manual-select-recording-card.png)

1. レコーディング カードで、最後に記録したステップのすぐ下で **アクションの追加** を選択します。
   このチュートリアルで前にリストアップした手動アクションの一覧が表示されます。 

1. 追加するアクションを選択します。 今回は **有効な要素の取得** を選択しましたが、自分のシナリオに適したアクションを選択できます。

   ![add.png へのアクションを選択](../media/edit-desktop/select-action-to-add.png)

アクションが追加されたら、アクションの詳細オプションで **セレクター** を設定する必要があります。

![アクションの詳細オプション](../media/edit-desktop/action-advanced-options.png "アクションの詳細オプション")

### <a name="set-the-selector"></a>セレクターの設定

セレクターにより、再生中、アクションが実行されるユーザー インターフェイス要素が特定されます。 可能であれば、同じユーザー インターフェイス要素をターゲットにする別のステップからこの情報をコピー/貼り付けすることをおすすめします。

セレクターの形式は次のとおりです:

```json
{  
   "type":"WinUIA",
   "parameters":{  
      "elementStack":[  

      ],
      "elementXPath":""
   }
}
```

セレクター要素の **elementStack** フィールドと **elementXPath** フィールドにデータを指定する必要があります。

**elementStack** は次の例のようになります。

![要素スタック](../media/edit-desktop/elementstack.png "要素スタック")

[WinAppDriver UI レコーダー](https://blogs.windows.com/windowsdeveloper/2018/06/20/introducing-winappdriver-ui-recorder/) を利用して **elementXPath** をキャプチャできます。

![WAD ツール](../media/edit-desktop/wad-tool.png "WAD ツール")

セレクターの **elementXPath** の結果を使用する前に、最初の要素 (/Window の前にあるもの全部) を削除します。

UI フローをテストし、セレクターが正しく機能することを確認します。

## <a name="use-advanced-controls"></a>詳細コントロールを使用する

UI フロー内に、**条件**、**スイッチ ケース**、**終了** アクションなどの詳細コントロールを組み込むことができます。

これらの詳細な操作を実行するには、既存の UI フローで次の手順を行います。

1. 作成した UI フロー > **その他のコマンド** (...) > **編集** を選択します。

1. ロジックを追加する UI フロー ステップの下矢印で、**+** > **アクションの追加** を選択します。

   ![アクションを追加する](../media/edit-desktop/add-action.png)

1. **組み込み** を選択し、使用可能なコントロール アクションの 1 つを選択します。

   ![組み込み](../media/edit-desktop/select-built-in.png)

1. 評価する必要がある式を入力します。 動的なコンテンツと式を使用して、条件を評価し、コントロールを切り替えることができます。 また、前の UI フロー ステップで生成された出力を使用することもできます。

   ![条件カード](../media/edit-desktop/condition-card.png)


## <a name="add-a-recording-of-a-remote-computer-using-image-recognition-preview"></a>画像認識を使用してリモート コンピューターの記録を追加する (プレビュー)

[!INCLUDE[cc-beta-prerelease-disclaimer](../includes/cc-preview-features-expect-changes.md)]

UI フローでの画像認識はプレビュー機能であり、現在はリモート デスクトップ接続 (RDC) アプリを介してリモート コンピューターを記録するときに利用できます。
 

### <a name="what-is-image-recognition"></a>画像認識とは?

現在、デスクトップ UI フローは、主にアクセシビリティ API (UI オートメーションとWinAppDriver) を使用して記録され、Microsoft Windows UI ツリーでコントロールを検出します。 Web ベースのアプリや Java アプリなどでは、UI ツリーが利用できない場合があります。 コントロールの ID が頻繁に、またはセッション間で変更される場合など、UI ツリーが信頼できない場合があります。 

画像認識により、クリック位置やその他の詳細が再生中に視覚的に一致し、自動化できるアプリケーションの範囲が大幅に拡大されます。 

### <a name="use-image-recognition-to-record-a-remote-computer"></a>画像認識を使用してリモート コンピューターを記録する

 
1. 新規または既存の UI フローで、[入力] タブに移動し、リモート デバイスへのログインに使用されるユーザー名用とパスワード用の 2 つの新しい **機密性の高いテキスト** 入力を作成します。 機密性の高いテキスト入力を使用すると、UI フロー自体によって格納またはログ記録されたりすることなく、別のフローから UI フローをテストまたは呼び出すときに値を動的に渡すことができます。

   ![機密性の高いテキスト ](../media/create-remote-desktop/ir-sensitive-text.png)

1. **レコーディングの追加** の手順に従って、新規または既存の UI フローのレコーダーコントロールを起動します。

1. リモート デスクトップ アプリを使用して、リモート コンピューターに接続します。

1. リモート デスクトップ ウィンドウを全画面に展開します。

1. レコーダー コントロールから **記録** を選択し、表示されるアラートで **OK** を選択します。

   ![ポップアップ](../media/create-remote-desktop/popup.png)

1. リモート コンピューターで手順を実行してから、レコーダー コントロール上で **完了** を選択します。

1. レコーディング内で **リモート デスクトップを起動** アクションを検索し、ユーザー名とパスワードの機密性の高いテキスト入力を入力します。

![ユーザー名とパスワードの機密性の高いテキスト](../media/create-remote-desktop/ir-launch-emote_desktop-session.png)

1. **保存** を選択し、UI フローをテストします。

>[!IMPORTANT]
>自動化されたフローからこの UI フローを呼び出す場合、[Azure Key Vault](https://azure.microsoft.com/services/key-vault/) などキー管理ソリューションを使用して、ユーザー名とパスワードを取得し、フロー自体に格納するのではなく、UI フローの **機密性の高いテキスト** 入力に動的に渡すことをお勧めします。 

>[!TIP]
> UI フローを呼び出しているフローの **デスクトップの UI フローの実行** アクションに対して **設定** メニューの **安全な入力** を有効にします。 これにより、入力が実行履歴に保存されなくなります。

### <a name="use-the-extract-text-from-image-action-while-recording-to-retrieve-an-output-from-a-remote-computer"></a>記録中に "画像からテキストを抽出" アクションを使用して、リモート コンピューターから出力を取得します。

1. ステップを記録しながら、キャプチャするテキストの場所に移動します。

1. レコーダー コントロールから **アウトプット** > **画像からテキストを抽出** を選択します。

1. プロンプトに従って、**アンカー エリア** (フィールドの横のラベルなど、変更が予想されない画面のセクション) を選択します。

    ![アンカー エリア](../media/create-remote-desktop/ir-anchors.png)

1.  **対象領域** (OCR を使用してテキストが抽出される領域) を選択します。

    ![対象地域](../media/create-remote-desktop/ir-targets.png)

1.  出力の名前を入力します。

1.  レコーダー コントロール上の **完了** を選択します。

1.  **保存** を選択し、UI フローをテストします。


### <a name="known-issues-for-remote-desktop-recordings"></a>リモート デスクトップ レコーディングに関する既知の問題

1. 同じ UI フローで次のステップを記録する前に、必要なすべての入力 (コンピューター名、ユーザー名、パスワード) が入力および保存されていることを確認してください。

1. 既存のリモート デスクトップ セッションに接続するには、セッションが同じ UI フローの早い段階で起動されている必要があります。

1. 記録時にリモート デスクトップ接続 (RDC) を起動する場合は、[スタート] メニューのリモート デスクトップ接続アプリ (mstc.exe) を使用することをお勧めします。 **リモート デスクトップを起動** アクションに加えて "Windows セキュリティ" アクションが記録されている場合は、再生が中断されないようにデザイナーから削除する必要があります (これは、リモート デスクトップ セッションがショートカットから起動されたときに発生する可能性があります)。

1. 画面スケーリング (Windowsの設定 > ディスプレイ > 画面スケーリング) が 100% 以外の値に設定されている画面で UI フローが記録された場合、再生が失敗する可能性があります。 回避策として、レコーディングする前に画面のスケーリングが 100% に設定されていることを確認してください。


## <a name="handle-error-conditions"></a>エラー状況を処理する

再生中に予期しない状況が発生することがあります。 これらの状況により、UI フローが失敗する可能性があります。 高度なエラー処理機能を使用すると、予期しない状況が発生した場合の代替ステップを作成できます。 

このステップを以下に示します。

1. 職場または学校のアカウントで [Power Automate](https://powerautomate.microsoft.com) にサインインする。
1. **マイ フロー** > **UI フロー** の順に選択します。
1. **その他のコマンド** (編集する UI フローの 3 つの垂直ドット) を選択します。
1. **編集**を選択します。
1. エラー処理を追加する UI フロー ステップの直前にある下矢印を選択し、**+** (新しいステップの挿入) を選択します。
   
   次の画像では、**PostElementText 1** ステップの前に新しいステップを挿入しています。 これは **PostElementText 1** が失敗した場合に、次に定義する代替ステップが実行されることを意味します。

      ![新しいステップの挿入の画像](../media/edit-desktop/insert-new-step.png) 

1. **並列分岐の追加** を選択します。

    ![並列分岐とその他のオプションの追加を示す画像](../media/edit-desktop/add-parallel-branch.png)

1. UI フローの実行中にエラーが発生した場合に、並列分岐で実行するアクションを選択します。

   **アプリの記録** を選択して、並列分岐の新しい記録を行うか、**組み込み** アクションから **終了** を選択して、エラーが発生した場合に UI フローを正常に終了することができます。

    ![並列分岐のオプションを示す画像](../media/edit-desktop/add-parallel-branch.png)

   >[!NOTE]
   >既定では、並列分岐に追加したアクションは、前のステップが失敗した場合にのみ実行されます。 並列分岐で **...** > **実行後の構成** の順に選択して既定の動作を変更することができます。 

      ![実行後の構成などのオプションを示す画像](../media/edit-desktop/configure-run-after.png)

1.  この画面では、並列分岐を実行する条件を選択できます。 4 つのオプションのいずれかを選択できます。

    ![実行後オプションを示す画像](../media/edit-desktop/run-after-options.png)

    注意：同じ条件で実行されるメイン分岐と並列分岐の両方のセットを含む UI フローを保存することはできません。



## <a name="enable-coordinate-based-playback"></a>座標ベースの再生の有効化

座標ベースの再生では、フォールバックとして、既定の Windows UI オートメーション フレームワークが再生中に見つけることができないターゲット オブジェクトを UI flows が検索できるようにする、相対的な画面座標オフセットが使用されます。 

既定の Windows UI オートメーション フレームワークが、ターゲット オブジェクトを再生中に見つけられない理由を次にいくつか示します:

- 自動化しているレガシ アプリケーションで、Windows UI オートメーション フレームワークをサポートするプログラミング テクノロジが使用されていない。
- アプリケーションまたはそのコントロールの UI オートメーション XPath、名前、または ID が一意でない。 
- アプリケーションに、名前または ID が変更される可能性があるダイナミック コントロールがある。 
- アプリケーションに、名前、ID、一意の識別子などのないコントロールがある。

>[!TIP]
>座標ベースの再生の精度を向上させるには、同じスケールと解像度を使用し、また記録中に対象アプリケーションを最大化します。

UI flow スクリプトの記録後、次の手順に従います:

1. アプリケーションを起動または接続する手順を展開します。
   
   これは通常、記録スクリプトの最初のステップです。
1. **詳細オプションの表示** を選択します。
1. **座標の再生の使用** プロパティを検索します。
1. 一覧から **はい** を選択し、座標ベースの再生を有効にします。

>[!TIP]
> そのアプリケーションに実行したすべての手順にこの設定を適用するには、各アプリケーションで **座標の再生の使用** を有効または無効にします。  


>[!WARNING]
>座標ベースの再生では、ターゲット アプリケーションの UI が大幅に変更されたなどのさまざまな理由により、ターゲット アプリケーションの一部ではないコントロールをオートメーションが選択する場合があります。


## <a name="next-steps"></a>次の手順

- 編集した [ UI フローを実行する](run-ui-flow.md) 方法について学習します。

- UI フローでより多くのことを行う場合は、[入力と出力](inputs-outputs-web.md) パラメーターで UI フローを試すこともできます。

