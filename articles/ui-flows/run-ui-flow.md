---
title: 他のフローから UI フローを実行する | Microsoft Docs
description: 有人モードまたは無人モードで、他のフローから UI フローを実行します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: kvivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/03/2020
ms.author: DeonHe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 0852e8b52f7b158d8fc97316b0f719f8e557a15f
ms.sourcegitcommit: 14ea422c0b306f738757036cc0e240584dd810f5
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/12/2020
ms.locfileid: "79188096"
---
# <a name="run-attended-and-unattended-ui-flows"></a>有人および無人の UI フローを実行する

[このトピックはプレリリース版のドキュメントであり、変更される可能性があります。]

[!INCLUDE [view-pending-approvals](../includes/cc-rebrand.md)]

UI フローを作成してテストした後は、イベント、スケジュール、またはボタンから実行できます。 これを可能にするには、UI フローを [自動化されたフロー](../get-started-logic-flow.md)、[ボタン フロー](../introduction-to-button-flows.md)、[スケジュールされたフロー](../run-scheduled-tasks.md)、または[ビジネス プロセス フロー](../business-process-flows-overview.md)に追加します。

## <a name="prerequisites"></a>前提条件

- Power Automate によって UI フローがトリガーされるようにするには、ご使用のデバイスに[オンプレミス データ ゲートウェイ](https://go.microsoft.com/fwlink/?LinkID=820580&clcid=0x409)が必要です。
   
   このゲートウェイは、Power Automate とデバイス (UI フローが実行される場所) 間の、エンタープライズ レベルのセキュリティで保護された接続です。 Power Automate では、イベント、スケジュール、またはボタンから UI フローをトリガーできるように、このゲートウェイを使用してオンプレミスのデバイスにアクセスします。
- 職場または学校アカウント。 

   >[!IMPORTANT]
   >ゲートウェイの設定、Power Automate へのサインイン、Windows デバイスへのログインには、同じ職場または学校アカウントを使用する必要があります。
   

## <a name="run-your-ui-flow-from-an-event-button-schedule-or-business-process-flow"></a>イベント、ボタン、スケジュール、またはビジネス プロセス フローから UI フローを実行する

この例では、自動化されたフローを使用して、新しいメールが届いたときに、UI フローをトリガーします。

1. [Power Automate](https://flow.microsoft.com/) に移動します。
1. 左側のナビゲーション バーで **[マイ フロー]** を選択します。
1. **[新規]** を選択した後、 **[自動--一から作成]** を選択します。

   >[!TIP]
   >必要に応じて、他の種類のフローを選択できます。

1. **[フロー名]** ボックスでフローに名前を付けます。
1. "新しいメール" を検索し、トリガーの一覧から **[新しいメールが届いたとき (V3)]** を選択します。 
    
   ![トリガーの選択](../media/run-ui-flow/2d4ec17d239169a46905cef1829fa3a1.png "トリガーの選択")

1. **[作成]** を選択してから、 **[新しいステップ]** を選びます。

1. **UI フロー**を検索し、 **[アクション]** の一覧から **[デスクトップの UI フローの実行]** を選択します。 

   ![検索アクション](../media/run-ui-flow/search-action.png "検索アクション")

1. ゲートウェイ情報とデバイスの資格情報を指定します。 

   これは、デバイスごとに 1 回行う必要があります。

    - **ゲートウェイ**: 前の手順で作成したゲートウェイを選択するか、 **[新しいゲートウェイ]** を使用して新しいゲートウェイを作成します。   
    - **ドメインとユーザー名**:デバイスから職場アカウントまたは学校アカウントを表示します。
    - **パスワード**:職場アカウントまたは学校アカウントのパスワードを指定します。

      ![接続の設定](../media/run-ui-flow/uiflow-connection-card.png "接続の設定")

      >[!TIP]
      >ゲートウェイが表示されない場合は、別の接続を選択する必要があるかもしれません。 これを行うには、 **[デスクトップの UI フローの実行 (プレビュー)]** カードの右上にある **[...]** を選択し、 **[自分の接続]** から使用する接続を選択します。

      ![新しい接続の選択](../media/run-ui-flow/select-new-connection.png "新しい接続の選択")

1. 以前に作成した UI フローを選択します。

   ![UI フローの選択](../media/run-ui-flow/select-ui-flow.png "UI フローの選択")

1. **[保存]** を選択して自動化されたフローを保存します。

1. フローをトリガーするメールを送信してフローをテストします。 記録したステップが UI フローで再生されます。 

![UI フローを呼び出す成功した実行](../media/run-ui-flow/successful-run.png "UI フローを呼び出す成功した実行")

>[!TIP]
>フローが実行されている間は、デバイスを操作しないでください。

## <a name="use-inputs-and-outputs"></a>入力と出力を使用する

UI フロー内で入力と出力を定義するときに、これらの入力と情報をやり取りすることができます。

1. UI フローをフローに追加すると、UI フローで定義された入力の一覧が表示されます。

   ![UI フローの入力](../media/run-ui-flow/inputs.png "UI フローの入力")

1. UI フローの各入力フィールドには、フローの前のステップの値を設定できます。 これを行うには、入力フィールドを選択し、トークン ピッカーから入力を選択します。


1. また、UI フローからの出力を、フロー内で後で表示されるアクションの入力として使用することもできます。 これを行うには、入力フィールドを選択し、トークン ピッカーから入力を選択します。

## <a name="run-ui-flows-unattended-or-attended"></a>UI フローを無人または有人で実行する

UI フローを作成するときは、これらを**有人**モードまたは **無人**モードで実行します。 無人実行は、人による監督が不要なアプリケーションに最適です。

無人で実行する場合、UI フローは Windows 10、Windows Server 2016、または Windows Server 2019 を実行しているターゲット デバイスに自動的にサインインします。 自動化が完了すると、UI フローはデバイスからサインアウトし、Power Automate でアクティビティが報告されます。

有人で実行する場合、UI フローでは既存の Windows ユーザー セッションが使用されます。

この記事の後半で説明するように、UI フローでは、マシンの状態に応じて有人モードと無人モードのどちらかが選択されます。

### <a name="unattended-mode"></a>無人モード

無人 UI フローを実行するには、サインアウトしたすべてのユーザーがターゲット マシンを使用できるようにする必要があります。ロックされている Windows ユーザー セッションがある場合は、UI フローを実行できません。

UI フローでは次の処理が実行されます。
1. UI フローでは、ターゲット デバイスで Windows ユーザー セッションが作成、管理、および解放されます。

1. 無人 UI フローは、画面がロックされているデバイスで実行されます。

1. デバイス (ロックされている場合も含む) 上にアクティブな Windows ユーザー セッションがある場合、Windows 10 デバイスを無人で実行することはできません。 次のエラーが表示されます。*UI フローを実行できません。ロックされたユーザー セッションまたは非アクティブなユーザー セッションがターゲット マシンにあります*。

1. Windows Server では、ロックされている Windows ユーザー セッションが存在し、UI フローを実行すると想定されているユーザーと同じユーザーによってそのセッションが開かれている場合、同じエラーが発生します。*UI フローを実行できません。ロックされたユーザー セッションまたは非アクティブなユーザー セッションがターゲット マシンにあります*。

### <a name="attended-mode"></a>有人モード
有人 UI フローを実行するには、接続用に構成されたユーザーの名前と一致するアクティブな Windows ユーザー セッションが必要です。 セッションをロックすることはできません。

ターゲット マシンで有人 UI フローの実行が開始されたら、実行が完了するまで、デバイスの操作 (例: マウスの移動) を回避することをお勧めします。


## <a name="schedule-multiple-ui-flows-on-the-same-device"></a>同じデバイスで複数の UI フローをスケジュールする

複数の UI フローを 1 つまたは複数のデバイスで実行するようにスケジュールできます。 同じデバイスで複数の UI フローの実行がトリガーされる場合、UI フロー バックエンドでは、次の規則に従って実行がオーケストレーション処理されます。

1.  最初の UI フローがターゲット デバイスに送信されます。

1.  その他の UI フローがキューに配置され、UI フローまたはゲートウェイの詳細ページに**待機中**として表示されます。

1.  各実行が完了すると、次の UI フローが送信されます。

>[!NOTE]
>これらのオーケストレーション規則は、同じユーザーまたは同じデバイス上の別のユーザーによってスケジュールされた両方の UI フローに適用されます。

>[!IMPORTANT]
>実行キュー内の UI フローが多すぎると、タイムアウトが発生する可能性があります。 UI フローの実行は、現在のところ、トリガーされてから 30 分以内に実行されないと失敗します。

## <a name="rerun-failed-ui-flows"></a>失敗した UI フローを再実行する

UI フローの実行が失敗した場合は、失敗の原因を修正した後に、または、場合によっては失敗した実行のトラブルシューティングを行うために、実行を試みることができます。

1. UI フローの詳細ページに移動し、再実行を試みる失敗した実行を特定します。

1. 目的の実行の親フローを選択します。

   これにより、UI フローが失敗した親フローの実行に移動します。

1. アクション メニューで、再送信ボタンを選択します。

## <a name="troubleshoot-failures"></a>エラーをトラブルシューティングする

### <a name="failed-ui-flows"></a>失敗した UI フロー

1. 無人 UI フローが失敗し、**新しいセッションを作成できない**というエラー メッセージが表示された場合は、次の手順に従って問題を解決してください。

    1.  Windows 10 では、ターゲット デバイス上に、ロックまたはロック解除されているアクティブなユーザー セッションがないことを確認します。
    1.  Windows Server 2016 または Windows Server 2019 では、マシン用に構成されているアクティブなユーザー セッションの最大数に達していないことを確認します。最大数に達している場合、UI フローで新しいセッションを作成して新しい UI フローを実行することはできません。

### <a name="ui-flows-app-status"></a>UI フロー アプリの状態

UI フロー アプリは、UI フロー実行を管理および実行する、ローカル マシンにインストールするソフトウェアです。 これにより、UI フロー クラウド サービスでは、マシン上の UI フローに対して通信とオーケストレーションを行うことができます。

ゲートウェイの一覧およびゲートウェイの詳細ページに、各デバイスの現在の UI フロー アプリの状態が表示されます。

![ゲートウェイの一覧を示すスクリーンショット](../media/run-ui-flow/gateway-list.png)

UI フロー アプリは、次のいずれかの状態になります。

1. **使用可能**:UI フロー アプリはオンラインであり、UI フローを実行する準備ができています。

1. **[実行中]** : マシン上で 1 つ以上の UI フローが実行されています。 バックエンドによってターゲット デバイスに送信されるその他の UI フローはキューに配置され、そのスロットが実行されるのを待ちます。

1. **ゲートウェイへの接続を修正**:UI フロー クラウド サービスがターゲット デバイスに接続できません。ゲートウェイ接続に問題があることが原因である可能性があります。 この問題を解決するには、接続にアクセスし、使用する資格情報が正しいことを確認します。

1. **不明**:この状態は、バックエンドが UI フロー アプリに接続できないことを意味します。

    1. **ゲートウェイの状態**が**オフライン**の場合は、デバイスの電源が入っていて、インターネットに接続されていることを確認します。 [ゲートウェイのトラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)を行うこともできます。

    1. **ゲートウェイの状態**が**オンライン**の場合は、次のアクションを試してください。

        1. デバイスで UI フロー アプリおよびサービスが実行されていることを確認します。

        1. デバイスで UI フロー サービスを再起動します。

## <a name="learn-more"></a>詳細情報

 - [オンプレミス データ ゲートウェイ](https://docs.microsoft.com/data-integration/gateway/service-gateway-app)のインストール。
 - [オンプレミス データ ゲートウェイのアプリの使用](https://docs.microsoft.com/flow/gateway-manage)に関するドキュメント
 - オンプレミス データ ゲートウェイの[トラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)。
