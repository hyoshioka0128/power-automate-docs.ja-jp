---
title: 他のフローから UI フローを実行する | Microsoft Docs
description: 有人モードまたは無人モードで、他のフローから UI フローを実行します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: kvivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/24/2020
ms.author: DeonHe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 7d9142fa86b256ca816cf128f8b76bae7d1c5a90
ms.sourcegitcommit: 855ee8b55aebe7b8e202006c39debfff02df1d30
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/03/2020
ms.locfileid: "3298926"
---
# <a name="run-attended-and-unattended-ui-flows"></a>有人および無人の UI フローを実行する

UI フローを作成してテストした後は、イベント、スケジュール、またはボタンから実行できます。 これを可能にするには、UI フローを [自動化されたフロー](../get-started-logic-flow.md)、[ボタン フロー](../introduction-to-button-flows.md)、[スケジュールされたフロー](../run-scheduled-tasks.md)、または[ビジネス プロセス フロー](../business-process-flows-overview.md)に追加します。

## <a name="prerequisites"></a>前提条件

- Power Automate によって UI フローがトリガーされるようにするには、ご使用のデバイスに [オンプレミス データ ゲートウェイ](https://go.microsoft.com/fwlink/?LinkID=820580&clcid=0x409) が必要です。
   
   ゲートウェイは、Power Automate とデバイス (UI フローが実行される場所) 間のエンタープライズ グレードの安全な接続です。 Power Automate では、イベント、スケジュール、またはボタンから UI フローをトリガーできるように、ゲートウェイを使用してオンプレミス デバイスにアクセスします。
- 職場または学校アカウント。 

   >[!IMPORTANT]
   >ゲートウェイの設定、Power Automate へのサインイン、Windows デバイスへのログインには、同じ職場または学校アカウントを使用する必要があります。
   

## <a name="run-your-ui-flow-from-an-event-button-schedule-or-business-process-flow"></a>イベント、ボタン、スケジュール、またはビジネス プロセス フローから UI フローを実行する

この例では、自動化されたフローを使用して、新しいメールが届いたときに、UI フローをトリガーします。

1. [Power Automate](https://flow.microsoft.com/)に移動します。
1. 左側のナビゲーション バーで **[マイ フロー]** を選択します。
1. **[新規]** を選択した後、**[自動--一から作成]** を選択します。

   >[!TIP]
   >必要に応じて、他の種類のフローを選択できます。

1. **[フロー名]** ボックスでフローに名前を付けます。
1. "新しいメール" を検索し、トリガーの一覧から **[新しいメールが届いたとき (V3)]** を選択します。 
    
   ![トリガーの選択](../media/run-ui-flow/select-email-trigger.png "トリガーを選択する")

1. **[作成]** を選択してから、**[新しいステップ]** を選びます。

1. **UI フロー**を検索し、**[アクション]** の一覧から **[デスクトップの UI フローの実行]** を選択します。 

   ![検索アクション](../media/run-ui-flow/search-action.png "検索アクション")

1. ゲートウェイ情報とデバイスの資格情報を指定します。 

   これは、デバイスごとに 1 回行う必要があります。

    - **ゲートウェイ**: 前の手順で作成したゲートウェイを選択するか、**新しいゲートウェイ** を使用して新しいゲートウェイを作成します。   
    - **ドメインとユーザー名**: デバイスから職場または学校アカウントを表示します。
       >[!Important]
        >これらの資格情報を使用してデバイスにログインできることを確認します。  
    - **パスワード**: 職場または学校アカウントのパスワードを指定します。

      ![接続の設定](../media/run-ui-flow/uiflow-connection-card.png "接続の設定")

      >[!TIP]
      >ゲートウェイが表示されない場合は、環境内のリージョンがゲートウェイ リージョンと異なる可能性があります。 詳細については、ゲートウェイ名の一覧で **[ゲートウェイが見つからない場合のトラブルシューティング]** を選択してください。 また、ゲートウェイと Power Automate のリージョンが [正しくマップされている](../regions-overview.md#region-mappings-for-power-automate-and-gateways) ことを確認できます。

      >[!TIP]
      >ゲートウェイが表示されない場合は、別の接続を選択する必要があるかもしれません。 これを行うには、**[デスクトップの UI フローの実行]** カードまたは **[Web の UI フローの実行]** カードの右上にある **[...]** を選択し、**[自分の接続]** から接続を選択します。


      ![新しい接続の選択](../media/run-ui-flow/select-new-connection.png "新しい接続の選択")

1. 以前に作成した UI フローを選択します。

   ![UI フローの選択](../media/run-ui-flow/select-ui-flow.png "UI フローの選択")

1. **[保存]** を選択して自動化されたフローを保存します。
 >[!TIP]
 >テストする前に、ゲートウェイがオンラインであることを確認します。 ナビゲーション ウィンドウで **[データ]** > **[ゲートウェイ]** に移動し、ゲートウェイ名を選択して、**[...]** をクリックして **[詳細]** に移動し、**ゲートウェイの状態**が**オンライン**かどうかを確認します。**ゲートウェイの状態**が**オフライン**の場合は、デバイスの電源が入っていてインターネットに接続されていることを確認します。 

1. フローをトリガーするメールを送信してフローをテストします。 記録したステップが UI フローで再生されます。 

![UI フローを呼び出す成功した実行](../media/run-ui-flow/successful-run.png "UI フローを呼び出す成功した実行")

>[!TIP]
>フローが実行されている間は、デバイスを操作しないでください。

## <a name="use-inputs-and-outputs"></a>入力と出力を使用する

UI フロー内で入力と出力を定義するときに、これらの入力と情報をやり取りすることができます。

1. UI フローをフローに追加すると、UI フローで定義された入力の一覧が表示されます。

   ![UI フローの入力](../media/run-ui-flow/inputs.png "UI フローの入力")

1. UI フローの各入力フィールドには、フローの前のステップの値を設定できます。 これを行うには、入力フィールドを選択し、トークン ピッカーから入力を選択します。


1. また、UI フローからの出力を、フロー内で後で表示されるアクションの入力として使用することもできます。 これを行うには、入力フィールドを選択し、トークン ピッカーから入力を選択します。

## <a name="run-ui-flows-unattended-or-attended"></a>UI フローを無人または有人で実行する

UI フローを作成するときは、これらを**有人**モードまたは **無人**モードで実行します。 無人実行は、人による監督が不要なアプリケーションに最適です。

無人で実行する場合、UI フローは Windows 10、Windows Server 2016、または Windows Server 2019 を実行するターゲット デバイスに自動的にサインインします。 自動化が完了すると、UI フローはデバイスからサインアウトし、Power Automate でアクティビティを報告します。

有人で実行する場合、UI フローでは既存の Windows ユーザー セッションが使用されます。

UI フローをフローに追加するときに、UI フローを有人で実行するか、または無人で実行するかを選択できます。 有人実行と無人実行の主な違いを次に示します。

### <a name="unattended-mode"></a>無人モード

無人 UI フローを実行するには、サインアウトしたすべてのユーザーがターゲット マシンを使用できるようにする必要があります。 

>[!IMPORTANT]
>ロックされている Windows ユーザー セッションがある場合は、UI フローを実行できません。

UI フローでは次の処理が実行されます。
1. UI フローでは、ターゲット デバイスで Windows ユーザー セッションが作成、管理、および解放されます。

1. 無人 UI フローは、画面がロックされているデバイスで実行され、実行中にフローは表示されません。

1. アクティブな Windows ユーザー セッション (ロックされている場合も含む) がある場合、Windows 10 デバイスを無人で実行することはできません。 次のエラーが表示されます: *UI フローを実行できません。ロックされたまたは非アクティブな Windows ユーザー セッションがターゲット デバイスにあります*。

1. Windows Server で、ロックされた Windows ユーザー セッションを UI フローが実行されると想定されているユーザーと同じユーザーで開いている場合、同じエラーが表示されます: *UI フローを実行できません。ロックされたまたは非アクティブな Windows ユーザー セッションがターゲット デバイスにあります*。

### <a name="attended-mode"></a>有人モード
有人 UI フローを実行するには、接続用に構成されたユーザーの名前と一致するアクティブな Windows ユーザー セッションが必要です。 セッションをロックすることはできません。

ターゲット マシンで有人 UI フローが開始されると、実行が完了するまでデバイスとの対話を避けることをお勧めします。


## <a name="schedule-multiple-ui-flows-on-the-same-device"></a>同じデバイスで複数の UI フローをスケジュールする

複数の UI フローを 1 つまたは複数のデバイスで実行するようにスケジュールできます。 複数の UI フローが同じデバイス上で実行するようトリガーされた場合、Power Automate は次の規則に従います:

1.  最初の UI フローはターゲット デバイスで実行されます。

1.  その他の UI フローはキューに配置され、UI フローまたはゲートウェイの詳細ページに **[待機中]** として表示されます。

1.  各実行が完了すると、次の UI フローが選択されます。

>[!NOTE]
>これらのオーケストレーション規則は、同じユーザー、または同じデバイス上の異なるユーザーによってスケジュールされた UI フローの実行に適用されます。

>[!IMPORTANT]
>実行キュー内の UI フローが多すぎると、タイムアウトが発生する可能性があります。 UI フローの実行は、トリガーされてから 30 分以内に実行されないと失敗します。

## <a name="load-balance-requests-across-gateways-in-a-cluster"></a>クラスター内のゲートウェイ間で要求を負荷分散する

クラスター内のゲートウェイ間で、UI フローの実行を均等に分散することを選択できます。 既定では、負荷分散中のゲートウェイの選択はランダムです。

[ゲートウェイを追加してクラスターを作成するには、これらの手順](https://docs.microsoft.com/data-integration/gateway/service-gateway-install#add-another-gateway-to-create-a-cluster)に従います。

>[!NOTE]
>クラスター内のオフライン ゲートウェイ メンバーは、パフォーマンスに悪影響を与えます。 これらのメンバーは無効にするか削除します。

Power Automate ゲートウェイの詳細ページから負荷分散を行うには、**データ** -> **ゲートウェイ** に移動し、ゲートウェイ クラスターを選択します。 

ゲートウェイの詳細ページで、[クラスター内のすべてのゲートウェイで実行する] をオンに切り替えます。 これにより、そのクラスター内のすべてのゲートウェイ上の UI フローの実行が分散されます。

   ![ゲートウェイ クラスターで UI フローの実行を分散する](../media/run-ui-flow/gw_cluster.png "ゲートウェイ クラスターで UI フローの実行を分散する")
   
>[!IMPORTANT]
>ローカル Windows アカウントを使用している場合は、クラスター内のすべてのマシンが同じローカル アカウントと同じパスワードを持っている必要があります。 これらの資格情報は、UI フロー接続を作成するときに使用します。
>Active Directory または Azure AD に参加しているマシンを使用している場合は、UI フロー接続で使用するユーザー アカウントがクラスター内のすべてのマシンにアクセスできることを確認します。
   
## <a name="best-practices-to-avoid-timeouts-and-distribute-load-across-machines"></a>タイムアウトを回避し、マシン間で負荷を分散するためのベストプラクティス

複数の UI フローを実行する予定がある場合は、負荷を分散するとともに、複数の UI フローが同時に実行されているためにターゲット マシンが過負荷になったり、タイムアウトになったりすることなく、すべての UI フローが正常に実行されるよう、一連の戦略を採用できます。 次のいずれかを実行できます:

1. UI フローを 1 日の異なる時間に実行するように計画し、経時的に負荷を分散させることができます。 これは、ワークロードを実行できる 1 つまたは少数セットのマシンがある場合に最適です。また、UI フローを開始するトリガー (スケジュールされたフローなど) を制御できます。
1. 同じ構成の UI フローを並行して実行できるマシンのクラスターを作成します。 
1. それぞれが異なるマシンをターゲットとする個別の接続を使用する、複数のフローを作成します。 

これらの戦略に従うことで、同じデバイスでの UI フローの競合や、場合によってはタイムアウトによる失敗を回避できます。 

>[!NOTE]
>UI フローを自動モードで実行している場合は、組織が並行して実行する予定の UI フローの数を予測し、適切な量の無人アドオンを購入する必要があります。 


## <a name="rerun-failed-ui-flows"></a>失敗した UI フローを再実行する

UI フローの実行が失敗した場合は、問題を修正してから、次の手順を行って再実行します。 

   1. 詳細ページに移動して、失敗した実行を特定します。

   1. アクション メニューで、**[再送信]** ボタンを選択します。

## <a name="troubleshoot-failures"></a>障害のトラブルシューティング

1. 無人 UI フローが失敗し、**新しいセッションを作成できない**というメッセージが表示された場合は、次の手順に従って問題を解決してください。

    - Windows 10 では、ターゲット デバイス上に、ロックまたはロック解除されているアクティブなユーザー セッションがないことを確認します。
    - Windows Server 2016 または Windows Server 2019 で、デバイス用に構成されているアクティブなユーザー セッションの最大数に達していないことを確認します。 UI フローは、新しいセッションを作成できない場合は実行できません。

1. 英語以外のオペレーティング システムで UI フローを実行していて、*[502 - 無効な要求]* メッセージが表示された場合は、[UI フローをプレビューからアップグレードする手順](upgrade.md)に従っていることを確認してください。


1. **ゲートウェイの状態**が**オフライン**の場合は、デバイスの電源が入っていて、インターネットに接続されていることを確認します。 [ゲートウェイのトラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)を行うこともできます。

1. **ゲートウェイの状態**が**オンライン**の場合は、次のアクションを試してください。

   - デバイスで UI フロー アプリおよびサービスが実行されていることを確認します。

   - デバイスで UI フロー サービスを再起動します。

## <a name="learn-more"></a>詳細はこちら

 - [オンプレミス データ ゲートウェイ](https://docs.microsoft.com/data-integration/gateway/service-gateway-app)のインストール。
 - [オンプレミス データ ゲートウェイのアプリの使用](https://docs.microsoft.com/flow/gateway-manage)に関するドキュメント
 - オンプレミス データ ゲートウェイの[トラブルシューティング](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)。



