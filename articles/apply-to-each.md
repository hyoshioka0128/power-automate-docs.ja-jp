---
title: '[それぞれに適用する] アクションを使用して項目の配列をループ処理する。  | Microsoft Docs'
description: Power Automate を使って項目の配列をループ処理し、複数の条件を調べ、それらの条件に基づいてアクションを実行します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: anneta
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/06/2020
ms.author: deonhe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 74f0c2ceccd418a272f91e53cc80c387fed07725
ms.sourcegitcommit: b043b7e8c29afee4f4f25bbf0d5a662d9af9272c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "4708535"
---
# <a name="use-the-apply-to-each-action-in-power-automate-to-process-a-list-of-items-periodically"></a>Power Automate の 各アクションに適用するアクションを使用して項目の一覧を定期的に処理する

受信トレイに新しいメールが到着したときなど、多くのトリガーはイベントに基づいてクラウド フローをすぐに開始できます。 このようなトリガーは便利ですが、定義されているスケジュールでデータ ソースを照会し、データ ソース内の項目のプロパティに基づいて特定のアクションを行うようなクラウド フローを実行したいこともあります。 これを行うには、フローをスケジュール (1日1回など) で開始し、**それぞれに適用する** などのループアクションを使用して項目の一覧を処理することができます。 たとえば、**それぞれに適用する** を使用すると、データベースのレコードや、Microsoft SharePoint の項目一覧を更新できます。

このチュートリアルでは、15 分ごとに実行して以下の処理を行うクラウド フローを作成します。

1. Office 365 Outlook 受信トレイにある最新の未読メッセージを 10 件取得します。
2. 10 件のメッセージをそれぞれ調べて、件名に **会議の開始** が含まれるかどうかを確認します。
3. 上司からのメールかどうか、または高重要度で送信されたかどうかを確認します。
4. 件名に **会議の開始** が含まれる、上司からのメールや高重要度で送信されたメールに対しては、プッシュ通知を送信し、既読としてマークします。

以下の図は、作成するフローの詳細を示しています :

![作成するフローの概要](./media/apply-to-each/foreach-flow-visio.png)

## <a name="prerequisites"></a>前提条件
このチュートリアルの手順を正しく実行するにあたっての要件を次に示します :

* [Power Automate](https://flow.microsoft.com) を使用するために登録されたアカウント。
* Office 365 Outlook アカウント。
* [Android](https://aka.ms/flowmobiledocsandroid) 向けの Power Automate モバイル アプリ、[iOS](https://aka.ms/flowmobiledocsios)、[Windows Phone](https://aka.ms/flowmobilewindows)。
* Office 365 Outlookへの接続と、プッシュ通知サービス。

[!INCLUDE [sharepoint-detailed-docs](includes/sharepoint-detailed-docs.md)]

## <a name="create-a-cloud-flow"></a>クラウド フローを作成
1. [Power Automate](https://flow.microsoft.com) にサインインする。
1. **自分のフロー** > **新規** > **最初からスケジュールを作成** の順に選択します
1. **スケジュールされたフローを構築する** 画面で、**フロー名** にフローの名前を入力してください。 
1. 15 分ごとに実行するようにスケジュールを設定します。 
1. **作成** を選択します 
   
    ![スケジュールの実行](./media/apply-to-each/foreach-3.png) 

1. **+ 新規ステップ** を選択し、続いて検索ボックスに **outlook** と入力して、 Microsoft Outlook に関連するすべてのアクションを検索します。
1. アクション **電子メールの取得 (V3)** を選択します :
1. **メールを取得する (V3)** カードが開きます。 受信トレイ フォルダーの先頭から未読のメールが 10 件選ばれるように、**電子メールの取得 (V3)** カードを構成します。 添付ファイルはフローで使われないため含めません :
   
    ![電子メールのカード構成を構成する](./media/apply-to-each/foreach-5.png)
   
   > [!NOTE]
   > ここまでの手順で、受信トレイからいくつかのメールを取得する簡単なフローができてきます。 これらのメールは配列で返されます。**それぞれに適用する** アクションには配列が必要となるため、これがまさに必要なことにあたります。

## <a name="add-actions-and-conditions"></a>アクションと条件を追加する
1. **新規ステップ** > **ビルトイン** > **それぞれに適用する** アクションを選択します。
1. **それぞれに適用する** カードの **以前の手順から出力を選択する** ボックスに **値** のトークンを挿入します。 これにより、**それぞれに適用する** アクションで使用するメールの本文が取得されます :
   
    ![本文 トークンの追加](./media/apply-to-each/foreach-7.png)
1. **新規ステップ** > **コントロール** > **条件** を選択します。
1. 各メールの件名で文字列 "会議の開始" を検索するように、**条件** カードを構成します。
   
   * **件名** トークンの最初のフィールドに、**状態** カードを挿入します。
   * 演算子の一覧から **含む** を選択します。
   * 3番目のフィールドに **会議の開始** を入力します。
     
     ![条件を構成する](./media/apply-to-each/foreach-subject-condition.png)
1. **アクションの追加** > **状態** から、選択肢 **である場合** を選択します。 **条件 2** カードが開きます。このカードを以下のように構成します :
   
   * 最初のフィールドに **重要度** トークンを挿入します。
   * 演算子の一覧から、**と等しい** を選択します。
   * 右側のフィールドに **高** を入力します。
     
     ![条件の追加](./media/apply-to-each/foreach-importance-condition.png)
1. **である場合** セクションで、**アクションの追加** を選択します。     
   **アクションを選択する** カードが開きます。ここでは、検索条件 (**会議の開始** を含むメールが高重要度で送信された) が true の場合の動作を定義します。
1. **通知** を検索し、**モバイル通知を送信する** アクションを選びます :
   
    ![通知の検索と選択](./media/apply-to-each/foreach-10.png)
1. **モバイル通知を送信する** カードで、メールの件名に "会議の開始" が含まれ、かつ **重要度** が **高** の場合に送信されるプッシュ通知の詳細を指定します。
   
    ![通知の構成](./media/apply-to-each/foreach-11.png)

1. **条件 2** カードの、 分岐 **該当しない場合** に戻ります :
    
    * **アクションの追加** を選び、検索ボックスに **上司を取得する** と入力します。
    * 検索結果の一覧から **上司を取得する (V2)** アクションを選びます。
    * **宛先** トークンを **上司を取得する (V2)** カードの **ユーザー (JPN)** ボックスに入力します。
      
      ![上司を取得するアクションの追加と構成](./media/apply-to-each/foreach-get-manager.png)
1. 分岐 **該当しない場合** から **アクションの追加** を選択します。
1. **状態** から **アクションを選択する** カードを選択します。 **条件 3** カードが開きます。ここでは、メール送信者のメール アドレス (From トークン) が上司のメール アドレス (Email トークン) と同じかどうかを調べるようにカードを構成します。
    
    * 最初のボックスに **送信元** トークンを挿入します。
    * 演算子の一覧から **含む** を選択します。
    * 右端のボックスに **電子メール** トークンを入力します。
      
      ![検索条件の構成](./media/apply-to-each/foreach-condition3-card.png)
1. **条件 3** の **である場合** セクションで、**アクションの追加** を選択します。
    
続いて、検索条件 (上司が送信したメール) が true の場合の動作を定義します。

1. **通知** を検索し、**モバイル通知を送信する** アクションを選びます :
    
     ![通知アクションの検索](./media/apply-to-each/foreach-10.png)
1. **モバイル通知を送信する 2** カードで、上司から送信されたメールである場合に送信されるプッシュ通知の詳細を指定し、**アクションの追加** を選択します。
    
     ![通知カードの構成](./media/apply-to-each/foreach-boss-notification.png)
1. **既読または未読にする (V2)** アクションを追加します。
1. **既読または未読にする (V2)** カードに **メッセージ Id** トークンを追加します。 **Message Id** トークンを探すには、**さらに表示する** を選択する必要がある場合があります。 **メッセージ Id** は、開封済みとされるメッセージ ID を示します。
1. **既読または未読にする (V2)** カードにて、**マークする** リストから **開封** を選択します。
    
     ![開封済みアクションの構成](./media/apply-to-each/foreach-mark-as-read2.png)
1. **保存** を選択して、 フローを保存します。

## <a name="run-the-flow"></a>フローを実行する
1. 件名に **会議の開始** が含まれる高重要度のメールを自分宛てに送信します (または、組織内のだれかにこのようなメールを送信してもらいます)。
1. 受信トレイにメールが未開封の状態で存在していることを確認します。
1. Power Automate にサインインし、 **自分のフロー** を選択します。
   
    自分のフローが表示されます。 
    
1. 作成したフローを選択し、**実行** を選択します。

   ![すぐに実行する](./media/apply-to-each/run-flow.png)

1. **フローの実行ページ** を選択し、結果を確認するフローの実行を選択します。
   
    ![実行結果](./media/apply-to-each/foreach-run-3.png)

## <a name="view-results-of-the-run"></a>実行の結果を表示する
フローが正常に実行されていれば、モバイル デバイスにプッシュ通知が送信されます。
   
> [!NOTE]
> プッシュ通知が届かない場合は、モバイル デバイスのデータ接続が正しくされていることを確認してください。
 

