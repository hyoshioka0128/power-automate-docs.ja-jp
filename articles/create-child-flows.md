---
title: 子フローを呼び出す
description: フローが他のフローを呼び出し、それらにパラメーターを渡すことができるようになりました。
author: MSFTMAN
ms.reviewer: deonhe
ms.date: 07/21/2020
ms.assetid: 6e6d3c34-b209-ea11-a811-000d3a4f1cdd
ms.topic: article
ms.service: business-applications
ms.author: deonhe
dynamics365pdf: true
ms.openlocfilehash: 1c7ac66d271820ba2b8a3e83041816a088fbb9ee
ms.sourcegitcommit: 9c893b055bdff2e1a6de04aa750289e2a13db96c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/22/2020
ms.locfileid: "3614265"
---
# <a name="create-child-flows"></a>子フローの作成

今日では、人々は何十、何百ものステップを必要とするフローを構築していますが、これらのアクションをすべて_1つの_ フローに入れようとすると、そのフローのナビゲートと維持が難しくなります。 

子フローを使用することで、フローの管理が簡単になり、フローに数百のステップを持たせることを回避できます。 このアプローチは、フロー内の複数の場所でタスクを再利用する場合や、複数のフローにまたがってタスクを再利用する場合に特に有効です。

連絡先の名前に基づいて Common Data Service で連絡先を作成、または更新する子フローが存在する場合の例を見てみましょう。

2つのフローを持つソリューションが必要になります :
- *子*フロー。 これは、*親*フローの中に入れ子になっているフローで、実行の対象とする小さなタスクが含まれています。
- *親*フロー。 このフローは任意のタイプのトリガーを持つことができ、子フローを呼び出します。

## <a name="create-the-child-flow-in-a-solution"></a>ソリューションに子フローを作成する

1. Power Automate にログインし、**ソリューション**を選択します。続いて既存のソリューションを選択します。 
   
   または、ソリューションを作成することができます。 

1. **新規** > **フロー** > **ボタン フロー** > **フローを手動でトリガーする**を選択します。 

   >[!TIP]
   >子フローのトリガーには、**Power Apps**、または **HTTP リクエストを受信したとき**を使用できます。

1. **入力の追加**を選択します。
   ここで定義する入力は、親フローから子フローに渡されます。

    ![親フローに由来する入力値](./media/call-child-flow/add-trigger-input.png "親フローに由来する入力値")

1. このチュートリアルでは、子フローが連絡先を作成するため、**連絡先**と**連絡先メールアドレス**が必要となります。

   ![子フローの入力](./media/call-child-flow/input-definition.png "子フローの入力")

1. 子フローを実行するロジックを構築します。 このロジックには、必要なだけの数のステップを含めることができます。 

   ステップの完了後は、データを親フローに返す必要があります。 この場合、次の2つのアクションのいずれかを使用できます :

   i. **Power Apps またはフローに応答する** (Power Apps コネクタ配下)。
   
   ii. **応答** (プレミアム HTTP 要求/応答コネクタ上)。

1. トリガーと同様に、子フローから返される出力を必要なだけ定義できます。 次の画像では、連絡先の ID を使用して応答できます。

   ![子フローの応答](./media/call-child-flow/response-output.png "子フローの応答")

1. フローに説明的な名前を付けた後、フローを保存します。 

   続いて、子フローをテストする必要があります。 このフローは手動でトリガーできるため、デザイナー内ですぐにテストすることができます。 いくつかの異なる入力で試して、出力が期待どおりとなることを確認してください。

1. フローが組み込みアクションや Common Data Service (現在の環境) コネクタ以外のものを使用している場合は、フロー内の接続で **埋め込み** を使用するようにフローを更新する必要があります。 これを行うには、[戻る]ボタンを選択して子フローのプロパティ ページに移動し、続いて**ユーザーのみを実行**タイル内で**編集**を選択します。

1. 表示されたペインで、フローで使用される各接続について、次を選択する必要があります: **実行専用ユーザーが提供する**の代わりに**この接続 (<_接続名>_)を使用する**。

1. **保存**を選択します。 現時点では、親フローから子フローに接続を渡すことはできません。 これを行わないと、子ワークフローは埋め込み接続のみに対応しているため、名前を子ワークフローとして使用できないことを示すエラーが表示されます。

## <a name="create-the-parent-flow-in-a-solution"></a>ソリューションに親フローを作成する

1. 子フローを作成したのと同じソリューションで親フローを構築します。
   
   または、既存のフローをそのソリューションに組み込むこともできます。 親フローは、任意のタイプのトリガーを持つことができます。

1. ご利用の*親フロー*の中で子フローを呼び出したい場所を探し、**組み込み**タブの**フロー**コネクタの配下にある**子フローを実行する**アクションを追加します。

1. 先ほど作成した子フローを選択します。 

   >[!NOTE]
   >アクセス権があり、ソリューション内にあるフローのみが表示されます。 子フローには、前述の3つのトリガーのいずれかが必要となります。

   ![実行する子フローを選択します](./media/call-child-flow/select-child-flow.png "実行する子フローを選択します")

1. 子のフローを選択すると、定義した_入力_値が表示されます。 子フローのアクションの後は、当該子フローに由来する任意の_出力_を使用できます。

   ![入力](./media/call-child-flow/view-child-flow-input.png "入力")

   子フローがフローの存続期間まで完了するまで待機します (組み込み接続と Common Data Service を使用するフローの場合は1年、それ以外のフローの場合は30日)。

1. このフローを保存して、テストします。 

   >[!TIP]
   >これら2つのフローを含むソリューションをエクスポートして別の環境にインポートすると、新しい親フローと子フローが自動的にリンクされるため、URLを更新する必要がありません。 
   