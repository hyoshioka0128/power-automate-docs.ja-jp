---
title: 全員が承認する必要のある承認フローを作成する | Microsoft Docs
description: 要求を承認するには全員の承認が必要な承認フロー、つまり 1 人でも拒否すれば要求が拒否される承認フローを作成します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: KVivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2020
ms.author: deonhe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 3f668d4462c06e061efe2a03b4e5e842364c4b6e
ms.sourcegitcommit: 5b1965a0c319c4294b7dc0c829120ed1f4f90444
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/25/2020
ms.locfileid: "82153485"
---
# <a name="create-an-approval-flow-that-requires-everyone-to-approve"></a>全員が承認する必要のある承認フローを作成する


このチュートリアルでは、休暇申請が承認されるためには全員 (割り当てられているすべての承認者) が同意する必要があり、どの承認者でも要求全体を拒否できる、承認ワークフローを作成する方法を示します。

この種の承認ワークフローは、休暇申請の承認に従業員のマネージャーとマネージャーのマネージャーの両方の同意を必要とする組織で役に立ちます。 ただし、いずれかのマネージャーは、他のユーザーの入力がなくても要求を拒否できます。

> [!NOTE]
> このチュートリアルは休暇承認シナリオですが、この種類の承認フローは、要求を承認するために複数の承認者が必要な任意の状況で使えます。
>
>

## <a name="prerequisites"></a>前提条件

* [Power Automate](https://flow.microsoft.com)、Microsoft Office 365 Outlook、Microsoft Office 365 ユーザーへのアクセス。
* SharePoint [リスト](https://support.office.com/article/SharePoint-lists-I-An-introduction-f11cd5fe-bc87-4f9e-9bfe-bbd87a22a194)。

    このチュートリアルでは、休暇申請に使う SharePoint リストを作成してあるものとします。 SharePoint リストの詳細を示す例については、[並列承認](parallel-modern-approvals.md)に関するチュートリアルをご覧ください。
* フロー作成の基本をよく理解している。

    [アクション、トリガー](multi-step-logic-flow.md#add-another-action)、および[条件](add-condition.md)の追加方法を確認することができます。 次の手順では、これらのアクションの実行方法がわかっていることを前提とします。

> [!NOTE]
> このチュートリアルでは、SharePoint と Office 365 Outlook を使用しますが、Zendesk、Salesforce、Gmail、Power Automate によってサポートされる [200 以上のサービス](https://flow.microsoft.com/connectors/)など、その他のサービスを使用することもできます。
>
>

## <a name="create-the-flow"></a>フローを作成する

> [!NOTE]
> 以前に SharePoint または Office 365 への接続を作成しており、サインインを求められた場合は、表示される指示に従います。
>
>

このチュートリアルではトークンを使います。 トークンの一覧を表示するには、いずれかの入力コントロールをタップまたはクリックし、表示される **[動的なコンテンツ]** の一覧でトークンを検索します。

[Power Automate](https://flow.microsoft.com) にサインインし、以下の手順を行ってフローを作成します。

1. 画面の右上で **[マイ フロー]**  >  **[新規]**  >  **[自動-一から作成]** の順に選びます。
1. フローに名前を付けてから、 **[SharePoint - When an item is created or modified]\(SharePoint - 項目が作成または変更されたとき\)** トリガーを追加します。
1. 休暇申請リストをホストする SharePoint サイトの **[サイトのアドレス]** を入力し、 **[リスト名]** からリストを選びます。
1. **[新しいステップ]** を選択し、Office 365 **上司の取得 (V2)** アクションを追加して、 **[ユーザー (UPN)]** ボックスを選んで、 **[作成者の電子メール]** トークンを追加します。

    **[Created By Email]\(作成者の電子メール\)** トークンは、 **[動的なコンテンツ]** の一覧の **[When an item is created or modified]\(項目が作成または変更されたとき\)** カテゴリにあります。 このトークンは、SharePoint で項目を作成したユーザーのマネージャーに関するデータへのアクセスを動的に提供します。

1. **[新しいステップ]** を選択し、別の Office 365 **上司の取得 (V2)** アクションを追加してから、**メール** トークンを **[ユーザー (UPN)]** ボックスに追加します。

    **メール** トークンは、 **[動的なコンテンツ]** リストの **[上司の取得 (V2)]** カテゴリにあります。 このトークンは、マネージャーのマネージャーのメール アドレスへのアクセスを動的に提供します。

    **[上司の取得 (V2) 2]** カードの名前を、"階層の上司をスキップする" のようなわかりやすい名前に変更することもできます。
1. **[新しいステップ]** を選択し、**開始して承認を待機**アクションを追加してから、 **[承認の種類]** リストから **[承認/拒否 - すべてのユーザーの承認が必須]** を選択します。

   > [!IMPORTANT]
   > いずれかの承認者が拒否した場合、承認要求はすべての承認者について拒否されたものと見なされます。
   >
   >
1. 次の表をガイドとして使用して、 **[開始して承認を待機]** カードを完成させます。

   | フィールド | Description |
   | --- | --- |
   | Approval type (承認の種類) |[承認の種類](#approval-types-and-their-behaviors)を参照してください。 |
   |  タイトル |承認要求のタイトルです。 |
   |  割り当て先 |承認者のメール アドレスです。 |
   |  詳細 |**[割り当て先]** フィールドに列記されている承認者に送信する追加情報です。 |
   |  アイテム リンク |承認項目の URL です。 この例では、これは SharePoint 内の項目へのリンクです。 |
   |  アイテム リンクの説明 |**[アイテム リンク]** の説明です。 |

   > [!TIP]
   > **開始して承認を待機**アクションでは、**応答**や**結果**など、複数のトークンが提供されます。 これらのトークンをフローで使って、承認要求フロー実行結果の充実したレポートを提供します。
   >
   >

    **[開始して承認を待機]** カードは、承認者に送信される承認要求のテンプレートです。 組織にとって便利なようにこれを構成します。 次に例を示します。

    ![開始して承認を待機](media/all-assigned-must-approve/start-an-approval-card.png)

    **[承認/拒否 - すべてのユーザーの承認が必須]** で**開始して承認を待機**アクションを含むフローを構成すると、フローはすべての**割り当て先**で承認されるまで、または少なくとも 1 つの**割り当て先**で承認要求が拒否されるまで待機します。

    >[!TIP]
    >フローで承認要求の応答を確認し、**結果**に基づいて異なるアクションを実行する場合は、**条件**ステップを追加します。 **結果**は**承認**または**拒否**のいずれかになります。 

    このフローを続行し、承認要求に対して決定が行われたときにメールを送信してみましょう。

1. **[新しいステップ]** を選択し、"メールの送信" を検索します。Office 365 Outlook **メールの送信 (V2)** アクションを追加してから、要求の結果を含むメールを休暇の申請者に送信するようにアクションを構成します。

    **[メールの送信 (V2)]** カードの例を次に示します。

    ![電子メールを送信](media/all-assigned-must-approve/send-an-email-card.png)

> [!NOTE]
> **開始して承認を待機**アクションの後のすべてのアクションは、 **[開始して承認を待機]** カードの **[承認の種類]** の一覧での選択に基づいて実行されます。 次の表は、選択に基づく動作の一覧です。
>
>

### <a name="approval-types-and-their-behaviors"></a>承認の種類とその動作

| Approval type (承認の種類) | 動作 |
| --- | --- |
| 承認/拒否 - すべてのユーザーの承認が必須 | 要求を完了するには、承認者**全員**の承認または拒否が必要です。 </p> **開始して承認を待機**アクションの後のアクションは、承認者**全員**が承認した後、または 1 回の拒否が行われた場合に実行されます。|
| 承認/拒否 - 最初に応答 | 任意の承認者による承認または拒否によって要求が完了します。  </p> **開始して承認を待機**アクションの後のアクションは、承認者の誰か 1 人が決定した後で実行されます。|
| カスタム応答 - すべての応答を待機 | プロセスを完了するには、すべての承認者が応答する必要があります。 |
| カスタム応答 - 1 つの応答を待機 | 任意の承認者からの応答により、プロセスが完了します。 |

画面の上部にある **[保存]** を選択してフローを保存します。

以上でフローが完成しました。 ここまで実行していれば、フローは次の図のようになります。

![フローの全体像の図](media/all-assigned-must-approve/overall-flow.png)

これで、SharePoint リストに項目が追加されるか項目が変更されるたびに、フローがトリガーされ、 **[開始して承認を待機]** カードの **[割り当て先]** に列記されているすべての承認者に承認要求が送信されるようになりました。 フローからは、Power Automate モバイル アプリおよびメールによって承認要求が送信されます。 SharePoint の項目を作成したユーザーは、要求の承認または拒否が明確に示された結果の概要をメールで受け取ります。

各承認者に送信される承認要求の例を次に示します。

![承認要求](media/all-assigned-must-approve/approval-request.png)

フロー実行後の応答および応答概要の例を次に示します。

![応答トークン](media/all-assigned-must-approve/response-output.png)

## <a name="learn-more-about-approvals"></a>承認に関する詳細

* [1 人の承認者による最新の承認](modern-approvals.md)
* [シーケンシャルな最新の承認](sequential-modern-approvals.md)
* [並列の最新の承認](parallel-modern-approvals.md)
* [承認と Common Data Service](common-data-model-approve.md)
* [外出先で要求を承認する](mobile-approvals.md)
