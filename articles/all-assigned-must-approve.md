---
title: 全員が承認する必要のある承認フローを作成する| Microsoft Docs
description: 要求を全員が承認するか、1 人が却下する必要がある承認フローを作成します。
services: ''
suite: flow
documentationcenter: na
author: msftman
manager: KVivek
editor: ''
tags: ''
ms.service: flow
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2020
ms.author: deonhe
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 7eb289ab295802c378f83221e49e9dea5e8a9371
ms.sourcegitcommit: b043b7e8c29afee4f4f25bbf0d5a662d9af9272c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/09/2020
ms.locfileid: "4708606"
---
# <a name="create-an-approval-flow-that-requires-everyone-to-approve"></a>全員が承認する必要のある承認フローを作成する


このチュートリアルでは、休暇申請が承認されるためには全員 (割り当てられているすべての承認者) が同意する必要があり、どの承認者でも要求全体を却下できる、承認ワークフローを作成する方法を示します。

この種の承認ワークフローは、休暇申請の承認に従業員のマネージャーとマネージャーのマネージャーの両方の同意を必要とする組織で役に立ちます。 ただし、いずれかのマネージャーは、他のユーザーの入力がなくても要求を拒否できます。

> [!NOTE]
> このチュートリアルは休暇承認シナリオですが、この種類の承認フローは、要求を承認するために複数の承認者が必要な任意の状況で使用できます。
>
>

## <a name="prerequisites"></a>前提条件

* [Power Automate](https://flow.microsoft.com) 、Microsoft Office 365Outlook、Microsoft Office 365 ユーザーへのアクセス。
* SharePoint [リスト](https://support.office.com/article/SharePoint-lists-I-An-introduction-f11cd5fe-bc87-4f9e-9bfe-bbd87a22a194)。

    このチュートリアルでは、既に休暇申請に使用する SharePoint  リストを作成してあることが前提となっています。 SharePoint のリストの詳細を示す例については、 [並列承認](parallel-modern-approvals.md) に関するチュートリアルをご覧ください。

    [!INCLUDE [sharepoint-detailed-docs](includes/sharepoint-detailed-docs.md)]
    
* フロー作成の基本を十分に理解していること。

    [アクション、トリガー](multi-step-logic-flow.md#add-another-action)、および[条件](add-condition.md)の追加方法を確認することができます。 次のステップでは、これらアクションの実行方法を理解すていることが前提となります。

> [!NOTE]
> このチュートリアルでは、SharePoint と Office 365 Outlook を使いますが、Zendesk、Salesforce、Gmail、などの Power Automate が対応している [200](https://flow.microsoft.com/connectors/) 以上のその他のサービスを使うこともできます。


## <a name="create-the-flow"></a>フローを作成する

> [!NOTE]
> SharePoint または Office 365 への接続をまだ作成していない場合、サインインが求められた際に表示される指示に従ってください。
>
>

このチュートリアルではトークンを使用します。 トークンの一覧を表示するには、いずれかの入力コントロールをタップまたはクリックし、表示される **動的コンテンツ** の一覧でトークンを検索します。

[Power Automate](https://flow.microsoft.com) にサインインし、以下の手順を行ってフローを作成します。

1. 画面の左上で **自分のフロー** > **新規** > **空白から自動作成** を選びます。
1. フローに名前を付け、**SharePoint -アイテムが作成または変更されたとき** のトリガーを作成します。
1. 休暇申請リストをホストする SharePoint サイトの **サイトのアドレス**  を入力し、**リスト名** からリストを選びます。
1. **新規ステップ** を選択し、 Office 365 **上司を取得する (V2)** アクションを追加します。**ユーザー (UPN)** ボックスを選択し、**電子メールで作成** トークンを追加します。

    **メールで作成** トークンは、**動的コンテンツ** 一覧の **項目が作成または変更されたとき** カテゴリにあります。 このトークンは、 SharePoint で項目を作成したユーザーのマネージャーに関するデータに対するアクセスを動的に提供します。

1. **新規ステップ** を選択し、Office 365 **上司を取得する (V2)** アクションをさらに追加します。続いて **ユーザー (UPN)** ボックスに **メール** トークンを追加します。

    **メール** トークンは、**動的なコンテンツ** 一覧の **上司を取得する  (V2)** カテゴリ配下にあります。 このトークンは、マネージャーのマネージャーのメール アドレスへのアクセスを動的に提供します。

    **上司を取得する (V2)** カードの名前は、"特定階層の上司をスキップする" のようなわかりやすい名前に変更できます。
1. **新規ステップ** を選択し、**開始して承認を待つ** アクションを追加します。続いて、**承認タイプ** リストから **承認/拒否-全員が承認必須** を追加します。

   > [!IMPORTANT]
   > いずれかの承認者が却下した場合、承認要求はすべての承認者について却下されたものと見なされます。
   >
   >
1. 次の表を参考にして、**開始して承認を待つ** カードを設定します。

   | フィールド | 内容 |
   | --- | --- |
   | 承認の種類 |[承認タイプ](#approval-types-and-their-behaviors) を参照してください。 |
   |  タイトル |承認要求のタイトル。 |
   |  割り当て先 |承認者のメール アドレス。 |
   |  詳細 |**割り当て先** フィールドに列記されている承認者に送信する追加情報。 |
   |  アイテムのリンク |承認項目の URL。 この例では、これは SharePoint 内の項目へのリンクです。 |
   |  アイテムのリンクの説明 |**アイテム リンク** の説明。 |

   > [!TIP]
   > **開始して承認を待つ** アクションでは、**応答** や **結果** など、複数のトークンが提供されます。 これらのトークンをフローで使用して、承認要求フロー実行結果の充実したレポートを提供します。
   >
   >

    **開始して承認を待つ** カードは、承認者に送信される承認要求のテンプレートです。 組織にとって便利なようにこれを構成します。 次に例を示します。

    ![開始して承認を待機](media/all-assigned-must-approve/start-an-approval-card.png)

    **開始して承認を待機** アクションが **承認/拒否 - すべてのユーザーの承認が必須** で構成されているクラウド フローは、**割り当て先ユーザー/グループ** がすべて承認するか、少なくとも 1 つの **割り当て先ユーザー/グループ** が承認リクエストを拒否するまで待機します。

    >[!TIP]
    >ご利用のフローが承認リクエストの応答を確認し、**結果** に応じて異なるアクションをさせたい場合は、**状態** ステップを追加します。 **結果** では **承認** または **拒否** することができます。 

    フローを続行して、承認リクエストで決定が下され際にメールを送信しましょう。

1. **新規ステップ** を選択し、「メールを送信する」を検索し、Office 365 Outlook の **メールを送信する（V2）** アクションを追加します。続いて、休暇に行きたい人に申請結果をメールで送信するようにアクションを設定します。

    **メールを送信する (V2)** カードの例を次に示します。

    ![電子メールの送信](media/all-assigned-must-approve/send-an-email-card.png)

> [!NOTE]
> **開始して承認を待つ** アクションの後に続くすべてのアクションは、**開始して承認を待つ** カードの **承認の種類** 一覧での選択に基づいて実行されます。 次の表は、選択に基づく動作の一覧です。
>
>

### <a name="approval-types-and-their-behaviors"></a>承認の種類とその動作

| 承認の種類 | 動作 |
| --- | --- |
| 承認/拒否 - 全員の承認が必須 | 要求を完了するには、**すべて** の承認者の承認または却下が必要となります。 </p> **すべて** の承認者が承認、またはいずれかの承認者が拒否した後に実行される **開始して承認を待つ** アクションに続くアクション。|
| 承認/拒否 - 最初に応答 | 要求を完了するには、いずれかの承認者が承認または却下する必要があります。  </p> **開始して承認を待つ** アクションに続くアクションは、承認者のいずれかが決定した後に実行されます。|
| カスタム応答 - すべての応答を待ちます | プロセスを完了するには、すべての承認者が応答する必要があります。 |
| カスタム応答 - いずれかの応答を待ちます | いずれかの承認者が応答することによりプロセスが完了します。 |

画面上部にある **保存** を選択して、フローを保存します。

以上でフローが完成しました! 以上の手順に従うと、フローは次の図のようになります。

![フローの全体像の図](media/all-assigned-must-approve/overall-flow.png)

SharePoint のリストに項目が追加される、または項目が変更されるたびに、**開始して承認を待つ** カードの **割り当て先** ボックスに列記されているすべての承認者に、フローが承認要求の送信をトリガーします。 フローが、Power Automate モバイル アプリとメールを介して承認リクエストを送信します。 SharePoint で項目を作成したユーザーは、要求の承認または拒否が明確に示された結果の概要をメールで受け取ります。

各承認者に送信される承認要求の例を示します。

![承認要求](media/all-assigned-must-approve/approval-request.png)

フロー実行後の応答および応答概要の例を示します。

![応答トークン](media/all-assigned-must-approve/response-output.png)

## <a name="learn-more-about-approvals"></a>承認に関する詳細

* [1 人の承認者による最新の承認](modern-approvals.md)
* [シーケンシャルな最新の承認](sequential-modern-approvals.md)
* [並列の最新の承認](parallel-modern-approvals.md)
* [承認と Common Data Service](common-data-model-approve.md)
* [外出先で要求を承認する](mobile-approvals.md)
