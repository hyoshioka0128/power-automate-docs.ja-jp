---
title: Power Apps で分岐を使用してビジネス プロセス フローを強化する | MicrosoftDocs
description: 業務プロセス フローで分岐を使用する方法を説明する
ms.custom: ''
ms.date: 06/27/2018
ms.tgt_pltfrm: ''
ms.topic: article
ms.service: flow
author: MSFTMAN
ms.assetid: 62cfac6b-0d78-48de-9364-0287454aa2a0
caps.latest.revision: 9
ms.author: Deonhe
manager: kvivek
search.app:
- Flow
search.audienceType:
- flowmaker
- enduser
ms.openlocfilehash: 821d06ec1fe4efcff4296f9e1bfb63f2b7503790
ms.sourcegitcommit: 9ee79e5b559429dc0e772b6fed763856dc8b51ee
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/30/2020
ms.locfileid: "3518055"
---
# <a name="tutorial-enhance-business-process-flows-with-branching"></a>チュートリアル: 分岐を使用して業務プロセス フローを強化する


業務プロセス フローは、完了までの営業、マーケティング、またサービス プロセスのさまざまなステージにユーザーを導きます。 シンプルなケースには、直線型のビジネス プロセス フローは適切なオプションです。 ただし、複雑なシナリオでは、分岐を使用するとビジネス プロセス フローが向上します。 ビジネス プロセス フローの作成権限がある場合は、`If-Else`論理を使用するとこで、複数の分岐を使用するビジネス プロセスのフローを作成できます。 分岐条件は、`AND` または `OR` 演算子の組み合わせを使用した複数の論理式で構成できます。 分岐選択は、プロセス定義時に定義されたルールに基づいてリアルタイムに自動的に実行されます。 たとえば、車の販売では、共通の見込み評価のステージの後で、ルール (顧客が購入したいのは新車か中古車か、予算が $20,000 より上か下かなど) に基づいて2つの別々の分岐に分かれる、単一の業務プロセスフローを構成できます。 例えば、新車を販売するのに一方の分岐、中古者を販売するのに他方の分岐に分かれます。 業務プロセス フローの詳細については、[業務プロセス フローの概要](business-process-flows-overview.md) を参照してください。  
  
 下の図は、分岐を使用した業務プロセス フローを示しています。  
  
 ![自動車販売プロセスのステップを示すフローチャート](media/example-car-sales-flow-chart.png "自動車販売プロセスのステップを示すフローチャート")  
  
<a name="Points"></a>   
## <a name="what-you-need-to-know-when-designing-business-process-flows-with-branches"></a>分岐を使用するビジネス プロセス フローを作成する際の注意点  
 分岐を使用するビジネス プロセス フローを設計する際に、次の情報に留意します。  
  
-   プロセスは、最大 5 個の一意のエンティティを含めることができます。  
  
-   プロセスごとに最大 30 のステージと、ステージごとに最大 30 のステップを使用できます。  
  
-   各分岐は 5 レベル以上深くすることはできません。  
  
-   分岐ルールは、その直前のステージのステップに基づいている必要があります。  
  
-   `AND` 演算子か`OR` 演算子を使用してルールに複数の条件を組み合わせることはできますが、これらの演算子を両方一緒に使用できません。  
  
-   プロセス フローを定義する場合、任意にエンティティ関連付けを選択できます。 この関連付けは、1:N (一対多) のエンティティの関連付けになります。  
  
-   複数のアクティブなプロセスを同じデータ レコード上で同時に実行することができます。  
  
-   ドラッグ アンド ドロップを使用して、プロセス フロー上のタイル (ステージ、手順、条件など) を再編することができます。  
  
-   分岐を統合する際、すべてのピア分岐を単一のステージに統合する必要があります。 ピア分岐はすべて単一のステージに統合するか、各ピア分岐がプロセスを終える必要があります。 ピア分岐は他の分岐と統合するできませんし、同時にプロセスを終了することはできません。

-   分岐はビジネス ルールに依存しているため、クライアント API の変更は分岐条件の評価をトリガーできません。
  
> [!NOTE]
> - プロセスで使用されるエンティティは、複数回再参照 (複数のクローズド エンティティ ループ) されることが可能です。  
> - プロセスはエンティティの種類に関係なく直前のステージに戻ることができます。 たとえば、見積もりレコードのアクティブなステージが**見積もりの配信**の場合、プロセス ユーザーはアクティブなステージを営業案件レコードの**提案**ステージに戻すことができます。  
>   
>   別の例では、プロセスは現在**リードを見込みありと評価** > **ニーズを特定** > **提案を作成** > **提案の提示** > **閉じる**のプロセス フローの**提案の提示**ステージにいるものとします。 顧客のニーズを特定するために顧客に提示する提案で詳細な調査が必要な場合は、ユーザーはプロセスの**ニーズを特定**ステージを選択し、**アクティブに設定**を選択するだけです。  
  
<a name="CarSelling365"></a>   
## <a name="example-car-selling-process-flow-with-two-branches"></a>例: 2 つの分岐がある自動車販売のプロセス フロー
 
新車販売と中古車販売の 2 つの分岐があるビジネス プロセス フローの例を見てみましょう。  
  
 最初に、**車販売プロセス**と言う名前の新しいプロセスを作成します。  
  
1.  [ソリューション エクスプローラーを開き](/powerapps/maker/model-driven-apps/advanced-navigation#solution-explorer)、左側のナビゲーション ウィンドウで **プロセス** を選択します。  
  
2.  新しいプロセスを作成する場合、**新規**を選択します。  
  
3.  **業務プロセス フロー**として**カテゴリ**を指定し、プライマリ**エンティティ**に対して**潜在顧客**を選択します。  
  
4.  **見込みありと評価する**と呼ばれるプロセスに最初のステージを追加します。次に、**購入時期**と**車の好み**というステップを追加します。  
  
5.  共通の**見込みありと評価**ステージの後で、**条件**タイルを使用して、プロセスを 2 つの分岐に分けます。  
  
    1.  ビジネス要件を満たすルールで条件タイルを構成  
  
    2.  ステージに最初の分岐を追加するには、条件タイルの [はい] パス上にステージ タイルを追加します。  
  
    3.  条件を満たさないときに実行する 2 番目の分岐を追加するには、条件のタイルの [いいえ] パス上にステージ タイルを追加します。  
  
> [!TIP]
>  既存の条件タイルの [いいえ] パス上に他の条件を追加して、更に複雑な分岐を作成することができます。  
  
 ![作成された [見込みありと評価する] ステージを示すイメージ](media/example-car-sales-qualify-stage.JPG "作成された [見込みありと評価する] ステージを示すイメージ")  
  
 **車の好み** = **新規**の場合、プロセスは**新車販売**ステージに分岐します。それ以外の場合は、以下に示すように 2 番目の分岐の**中古車販売**ステージに移動します。  
  
 ![新車営業段階を示すイメージ](media/example-car-sales-new-stage-1.JPG "新車営業段階を示すイメージ")  
  
 ![中古車の営業段階](media/example-car-sales-pre-owned-stage.JPG "中古車の営業段階")  
  
 **新車販売**ステージまたは**中古車販売**ステージのすべてのステップを終了したら、プロセスは、**見積もり提供**ステージのあるメイン フローに戻ります。  
  
 ![見積もり提供ステージ](media/example-car-sales-deliver-quote-stage.JPG "見積もり提供ステージ")  
  
<a name="PreventInformation"></a>   
## <a name="prevent-information-disclosure"></a>情報開示を防ぐ  
 次に、銀行での融資要請プロセスのために分岐を使用するビジネス プロセスのフローを考えてみましょう。 ステージで使用しているカスタム エンティティは、かっこに表示されます。  
  
 ![情報漏洩防止のためのプロセス例のステップを示すフロー チャート](media/example-car-sales-flow-chart-process-prevent-information-disclosure.png "情報漏洩防止のためのプロセス例のステップを示すフロー チャート")  
  
 このシナリオでは、銀行のローン担当者は要求レコードにアクセスする必要がありますが、ローン担当者が要求の調査内容を見る必要はありません。 融資担当者に調査エンティティへのアクセスを許可しないセキュリティ ロールを割り当てることで、このことは簡単に行えるように見えます。 より詳しく見ることで、本当に簡単かどうか確認してみましょう。  
  
 顧客が $60,000 の貸付けを銀行に要請したとします。 融資担当者は、最初のステージでこの要請を確認します。 銀行への借金額が $50,000 を超過するかどうかを確認する分岐ルールが満たされた場合、プロセスの次のステージは、この要請が不正でないかを検討することです。 これが不正であることが決定されると、プロセスは要請者に対して法的処置を取るステージに進みます。 ローン担当者は、調査エンティティへのアクセス権がないため、2 つの調査ステージを見ることができません。  
  
 ただし、ローン担当者が申し込みレコードを開くと、エンドツーエンドのプロセス全体を見ることができます。 ローン担当者は、不正な調査ステージを見られるだけでなく、プロセス内の法的措置のステージを見られるため、調査結果を特定することもできます。 また、担当者は、ステージを選択して、調査ステージのステップをプレビューすることもできます。 ローン担当者は、データまたはステップの完了状態を見ることはできませんが、調査と法的措置のステージで申し込み者に対して取られた可能性があるアクションを特定できます。  
  
 このプロセス フローでは、融資担当者は不正調査ステージと法的処置ステージを見ることができ、これは不適切な情報開示になります。 分岐を使用することで開示される可能性のある情報に特別な注意を払うことをお勧めします。 この例では、要請プロセスと不正調査プロセスの個別の 2 種類にプロセスを分け、情報開示を防ぎます。 融資担当者のプロセスは次のようになります。  
  
 ![情報漏洩防止のためのプロセスの追加ステップを示すフロー チャート](media/example-car-sales-flow-chart-additional-steps-prevent-information-disclosure.png "情報漏えいを防ぐためのプロセスの追加ステップを示すフローチャート")  
  
 調査のためのプロセスは、自己完結型で、以下のステージを含んでいます。  
  
 ![情報漏洩事例の調査プロセスのステップを示すフローチャート](media/example-car-sales-flow-chart-investigation-information-disclosure-case.png "情報漏えいケースの調査プロセスのステップを示すフローチャート")  
  
 調査レコードから要請レコードに承認/非承認の決定を同期させるワークフローを設定する必要があります。  
  
### <a name="next-steps"></a>次の手順  
 [ビジネス プロセス フローの作成](create-business-process-flow.md)   
 [プロセスを通じてカスタム ビジネス ロジックを作成する](guide-staff-through-common-tasks-processes.md)   
 
